{"version":3,"file":"index.es.js","sources":["../src/util/uuid.ts","../src/util/enumerate.ts","../src/util/is-plain-text.ts","../src/whitespace.ts","../src/consts.ts","../src/de.ts","../src/jsx.ts","../src/jsx-runtime.ts","../src/render.ts","../src/se.tsx"],"sourcesContent":["// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nconst r = new Uint8Array(16)\n\nfunction s(start: number, end: number): string {\n    return Array.from(\n        r.subarray(start, end),\n        x => x.toString(16).padStart(2, '0'),\n    ).join('')\n}\n\nexport function v4(): string {\n    window.crypto.getRandomValues(r)\n    r[6] = 0x40 | (r[6] & 0x0f)\n    r[8] = 0x40 | (r[8] & 0x3f)\n    return `${s(0, 4)}-${s(4, 6)}-${s(6, 8)}-${s(8, 10)}-${s(10, 16)}`\n}\n","// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\n/** Yield items of an iterable together with their indices */\nexport default function *enumerate<T>(iter: Iterable<T>, reverse?: boolean): Iterable<[number, T]> {\n    if (reverse) {\n        if (Array.isArray(iter)) {\n            for (let index = iter.length - 1 ; index >= 0 ; --index) {\n                yield [index, iter[index]]\n            }\n        } else {\n            yield* enumerate(Array.from(iter), true)\n        }\n        return\n    }\n\n    let index = 0\n\n    for (const value of iter) {\n        yield [index++, value]\n    }\n}\n","// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport { StyledText } from 'cnx-designer'\nimport { Element, Node } from 'slate'\n\nconst KNOWN_TEXT_PROPS = ['text', 'emphasis', 'strong', 'position']\n\n/** Check if a node contains only plain, unmarked text */\nexport default function isPlainText(node: Node): boolean {\n    if (Element.isElement(node)) {\n        return node.children.every(isPlainText)\n    }\n\n    if (!Object.keys(node).every(key => KNOWN_TEXT_PROPS.includes(key))) {\n        return false\n    }\n\n    const text = node as StyledText\n\n    return !text.emphasis\n        && !text.strong\n        && (text.position == null || text.position === 'normal')\n}\n","// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport { Editor, Element, Node, Path, Point, Text, Transforms } from 'slate'\n\nimport { enumerate, isPlainText } from './util'\n\n/**\n * Normalize white space in a node.\n *\n * White space codepoints in Unicode can be roughly divided into four categories\n * spacing marks, non-breaking spacing marks, zero-width marks, and line breaks.\n *\n * Spacing marks are codepoints used (usually) to separate words. As of Unicode\n * 12.1 those are: U+0009 CHARACTER TABULATION, U+0020 SPACE, U+1680 OGHAM SPACE\n * MARK, U+2000 EN QUAD, U+2001 EM QUAD, U+2002 EN SPACE, U+2003 EM SPACE,\n * U+2004 THREE-PER-EM SPACE, U+2005 FOUR-PER-EM SPACE, U+2006 SIX-PER-EM SPACE,\n * U+2008 PUNCTUATION SPACE, U+2009 THIN SPACE, U+200A HAIR SAPCE, U+205F MEDIUM\n * MATHEMATICAL SPACE, and U+3000 IDEOGRAPHIC SPACE.\n *\n * Non-breaking spacing marks are spacing marks which prevent line breaks from\n * being inserted. As of Unicode 12.1 those are: U+00A0 NO-BREAK SPACE,\n * U+2007 FIGURE SPACE, and U+202F NARROW NO-BREAK SPACE.\n *\n * Zero-width marks are codepoints which themselves do not impact spacing\n * between words (hence zero-width), but affect spacing and rendering in other\n * ways. As of Unicode 12.1 those are: U+180E MONGOLIAN VOWEL SEPARATOR,\n * U+200B ZERO WIDTH SPACE, U+200C ZERO WIDTH NON-JOINER, U+200D ZERO WIDTH\n * JOINER, U+2060 WORD JOINER, and U+FEFF ZERO WIDTH NON-BREAKING SPACE.\n *\n * Line breaks are codepoints which introduce a line break. As of Unicode 12.1\n * those are: U+000A LINE FEED, U+000B LINE TABULATION, U+000C FORM FEED,\n * U+000D CARRAGE RETURN, U+0085 NEXT LINE, U+2028 LINE SEPARATOR, and\n * U+2029 PARAGRAPH SEPARATOR.\n *\n * White space normalization is done in steps:\n *\n * 1.  First all spacing marks and line breaks are changed into U+0020 SPACE,\n *     all non-breaking spacing marks into U+00A0 NO-BREAK SPACE, and U+FEFF\n *     ZERO WIDTH NON-BREAKING SPACE into U+2060 WORD JOINER. The exception to\n *     this are U+1680 OGHAM SPACE MARK and U+3000 IDEOGRAPHIC SPACE which are\n *     left unchanged.\n *\n * 2.  Next, all zero-width marks neighbouring a spacing mark are removed.\n *\n * 3.  Next, sequences consisting of a single white space codepoint are\n *     collapsed into a single codepoint.\n *\n * 4.  Next, all spacing marks neighbouring U+1680 OGHAM SPACE MARK or\n *     U+3000 IDEOGRAPHIC SPACE are removed.\n *\n * 5.  Next, all spacing marks neighbouring a non-breaking spacing mark are\n *     removed.\n *\n * 6.  Next, if there still are sequences of white spaces, only their first code\n *     point is retained.\n *\n * 7.  Finally, white space is stripped from beginning and end of nodes, and\n *     end points of marks and inlines are adjusted so that they don't begin or\n *     end with white spaces.\n *\n * Note that this is a conceptual description, and the actual implementation may\n * differ slightly (for example it performs step 7 first).\n */\nexport default function normalizeWhiteSpace(editor: Editor, at: Path): void {\n    const node = Node.get(editor, at)\n\n    const ends = Editor.isInline(editor, node) ? 'unwrap' : 'trim'\n    normalizeTextBoundaries(editor, { at, ends })\n\n    normalizeSpaces(editor, at)\n}\n\n/**\n * Adjust marks and inlines so that they don't start or end with white space.\n *\n * This function performs the 7th step of white space normalization.\n */\nfunction normalizeTextBoundaries(\n    editor: Editor,\n    options: {\n        at: Path,\n        ends?: 'unwrap' | 'trim',\n    },\n): void {\n    const { at, ends = 'trim' } = options\n    const nodePath = Editor.pathRef(editor, at)\n\n    // Step 1: adjust white space such that no inline element and no marked text\n    // start or end with a white space.\n    for (const [child, path] of Node.children(editor, nodePath.current!, { reverse: true })) {\n        // Recursively normalize nested elements.\n        if (Element.isElement(child)) {\n            normalizeTextBoundaries(editor, { at: path, ends: 'unwrap' })\n            continue\n        }\n\n        if (isPlainText(child)) {\n            continue\n        }\n\n        const [, before, , after] = child.text.match(/^(\\s*)(.*?)(\\s*)$/)!\n\n        if (after.length > 0) {\n            Transforms.splitNodes(editor, {\n                at: { path, offset: child.text.length - after.length },\n                match: Text.isText,\n            })\n            Transforms.unsetNodes(editor, Object.keys(child), { at: Path.next(path) })\n        }\n\n        if (before.length > 0) {\n            Transforms.splitNodes(editor, {\n                at: { path, offset: before.length },\n                match: Text.isText,\n            })\n            Transforms.unsetNodes(editor, Object.keys(child), { at: path })\n        }\n    }\n\n    // Step 2: remove any white space at start and end of this node by either\n    // unwrapping or trimming it.\n\n    const end = findWhitespaceBoundary(editor, { at: nodePath.current!, affinity: 'end' })\n\n    if (end != null && !Editor.isEnd(editor, end, nodePath.current!)) {\n        if (ends === 'unwrap') {\n            Transforms.splitNodes(editor, { at: end, match: Text.isText, always: true })\n            Transforms.liftNodes(editor, {\n                at: Editor.range(editor, Path.next(end.path), nodePath.current!),\n                match: Text.isText,\n            })\n        } else {\n            Transforms.delete(editor, { at: Editor.range(editor, end, at), hanging: true })\n        }\n    }\n\n    const start = findWhitespaceBoundary(editor, { at: nodePath.current!, affinity: 'start' })\n\n    if (start != null && !Editor.isStart(editor, start, nodePath.current!)) {\n        if (ends === 'unwrap') {\n            Transforms.splitNodes(editor, { at: start, match: Text.isText, always: true })\n            Transforms.liftNodes(editor, {\n                at: Editor.range(editor, nodePath.current!, start),\n                match: Text.isText,\n            })\n        } else {\n            Transforms.delete(editor, {\n                at: Editor.range(editor, nodePath.current!, start),\n                hanging: true,\n            })\n        }\n    }\n\n    // Step 3: merge any two consecutive text elements into one, as long as they\n    // have the same properties, and remove empty text nodes.\n    collapseAdjacentText(editor, nodePath.current!)\n\n    // Step 4: ensure that all elements begin and end with a text node.\n    const node = Node.get(editor, nodePath.current!) as Element\n\n    if (editor.isInline(node)) {\n        if (!Text.isText(node.children[node.children.length - 1])) {\n            editor.apply({\n                type: 'insert_node',\n                path: [...nodePath.current!, node.children.length],\n                node: { text: '' },\n            })\n        }\n\n        if (!Text.isText(node.children[0])) {\n            editor.apply({\n                type: 'insert_node',\n                path: [...nodePath.current!, 0],\n                node: { text: '' },\n            })\n        }\n    }\n\n    nodePath.unref()\n}\n\nfunction findWhitespaceBoundary(\n    editor: Editor,\n    options: {\n        at: Path,\n        affinity: 'start' | 'end',\n    },\n): Point | undefined {\n    const { at, affinity } = options\n    const node = Node.get(editor, at)\n    const re = affinity === 'start' ? /^\\s*/u : /\\s*$/u\n\n    if (Text.isText(node)) {\n        const match = node.text.match(re)!\n\n        return {\n            path: at,\n            offset: affinity === 'start'\n                ? match[0].length\n                : match.index!,\n        }\n    }\n\n    for (const [index, child] of enumerate(node.children, affinity === 'end')) {\n        if (!Text.isText(child)) {\n            return affinity === 'start'\n                ? Editor.start(editor, [...at, index])\n                : Editor.end(editor, [...at, index])\n        }\n\n        const match = child.text.match(re)!\n\n        if (match[0].length === child.text.length) continue\n\n        return {\n            path: [...at, index],\n            offset: affinity === 'start'\n                ? match[0].length\n                : match.index!,\n        }\n    }\n}\n\n/** Merge any subsequent text elements sharing same properties */\nexport function collapseAdjacentText(editor: Editor, at: Path): void {\n    const node = Node.get(editor, at) as Element\n\n    for (const [index, child] of enumerate(node.children, true)) {\n        const prev = node.children[index - 1]\n\n        if (Text.isText(child) && Text.isText(prev)\n        && Text.equals(child, prev, { loose: true })) {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const { text, ...rest } = child\n            editor.apply({\n                type: 'merge_node',\n                path: [...at, index],\n                position: prev.text.length,\n                target: null,\n                properties: rest,\n            })\n        }\n    }\n}\n\n/**\n * Simplify white space by replacing certain groups of code points with a single\n * codepoint.\n *\n * This function performs steps 1 through 6, assuming that step 7 has already\n * been performed.\n */\nfunction normalizeSpaces(editor: Editor, at: Path) {\n    const node = Node.get(editor, at)\n\n    if (!Text.isText(node)) {\n        for (let i = 0 ; i < node.children.length ; ++i) {\n            normalizeSpaces(editor, [...at, i])\n        }\n        return\n    }\n\n    // no-misleading-character-class warns against using sequences of joining\n    // codepoints as they look like a single character but will be matched\n    // separately. Here this is exactly what we want, so we can safely disable\n    // this lint.\n    /* eslint-disable no-misleading-character-class, max-len */\n\n    // NOTE: this is incredibly slow, but necessary, as there may be refs placed\n    // in `node`. If we applied all changes at once (as one remove_text and one\n    // insert_text operation), position of these refs would be lost.\n\n    // 1st step\n    regexReplace(editor, at, /\\s/gu, replaceWSChar)\n    // 2nd step\n    regexReplace(editor, at, /\\s[\\u180e\\u200b\\u200c\\u200d\\u2060]/g, c => c[0])\n    regexReplace(editor, at, /[\\u180e\\u200b\\u200c\\u200d\\u2060]\\s/g, c => c[1])\n    // 3rd step\n    regexReplace(editor, at, /[\\s\\u180e\\u200b\\u200c\\u200d\\u2060]{2,}/g, collapseWSSequence)\n    // 4th step\n    regexReplace(editor, at, /[\\u0020\\u2000-\\u2006\\u2008\\u2009\\u200A\\u205F]+([\\u1680\\u3000])/g, (_, r) => r!)\n    regexReplace(editor, at, /([\\u1680\\u3000][\\u0020\\u2000-\\u2006\\u2008\\u2009\\u200A\\u205F]+)/g, (_, r) => r!)\n    // 5th step\n    regexReplace(editor, at, /[\\u0020\\u1680\\u2000-\\u2006\\u2008\\u2009\\u200A\\u205F\\u3000]+([\\u00a0])/g, (_, r) => r!)\n    regexReplace(editor, at, /([\\u00a0][\\u0020\\u1680\\u2000-\\u2006\\u2008\\u2009\\u200A\\u205F\\u3000]+)/g, (_, r) => r!)\n    // 6th step\n    regexReplace(editor, at, /[\\s\\u180e\\u200b\\u200c\\u200d\\u2060]{2,}/g, c => c[0])\n\n    /* eslint-enable no-misleading-character-class, max-len */\n}\n\nconst WHITE_SPACE_MAP: { [key: string]: string | undefined } = {\n    '\\u0009': ' ', // CHARACTER TABULATION\n    '\\u000a': ' ', // LINE FEED\n    '\\u000b': ' ', // LINE TABULATION\n    '\\u000c': ' ', // FORM FEED\n    '\\u000d': ' ', // CARRAGE RETURN\n    '\\u0085': ' ', // NEXT LINE\n    '\\u2000': ' ', // EN QUAD\n    '\\u2001': ' ', // EM QUAD\n    '\\u2002': ' ', // EN SPACE\n    '\\u2003': ' ', // EM SPACE\n    '\\u2004': ' ', // THREE-PER-EM SPACE\n    '\\u2005': ' ', // FOUR-PER-EM SPACE\n    '\\u2006': ' ', // SIX-PER-EM SPACE\n    '\\u2007': '\\u00a0', // FIGURE SPACE\n    '\\u2008': ' ', // PUNCTUATION SPACE\n    '\\u2009': ' ', // THIN SPACE\n    '\\u200a': ' ', // HAIR SAPCE\n    '\\u2028': ' ', // LINE SEPARATOR\n    '\\u2029': ' ', // PARAGRAPH SEPARATOR\n    '\\u202f': '\\u00a0', // NARROW NO-BREAK SPACE\n    '\\u205f': ' ', // MEDIUM MATHEMATICAL SPACE\n    '\\ufeff': '\\u2060', // ZERO WIDTH NON-BREAKING SPACE\n}\n\nfunction replaceWSChar(char: string): string {\n    return WHITE_SPACE_MAP[char] ?? char\n}\n\nfunction collapseWSSequence(seq: string): string {\n    let start = 0\n    let out = ''\n\n    for (let i=1 ; i<seq.length ; ++i) {\n        if (seq[i] !== seq[start]) {\n            out += seq[start]\n            start = i\n        }\n    }\n\n    if (seq[start] === seq[seq.length - 1]) {\n        out += seq[start]\n    }\n\n    return out\n}\n\n/**\n * Equivalent of String#replace working on Slate nodes\n *\n * This function will replace each occurrence by issuing `remove_text` and\n * `apply_text` operations.\n *\n * `path` must point at a {@link Text} node.\n */\nfunction regexReplace(\n    editor: Editor,\n    path: Path,\n    re: RegExp,\n    replacer: (substring: string, ...args: (string | undefined)[]) => string,\n) {\n    Editor.withoutNormalizing(editor, () => {\n        const node = Node.get(editor, path)\n\n        if (!Text.isText(node)) {\n            throw new Error(`Cannot RegExp replace a non-text node at path [${path}]`)\n        }\n\n        let adjust = 0\n\n        for (const m of node.text.matchAll(re)) {\n            const [remove, ...args] = m\n            const add = replacer(remove, ...args)\n            const offset = m.index! + adjust\n\n            editor.apply({ type: 'remove_text', path, offset, text: remove })\n            editor.apply({ type: 'insert_text', path, offset, text: add })\n\n            adjust += add.length - remove.length\n        }\n    })\n}\n","export const XML_NAMESPACE = 'http://www.w3.org/XML/1998/namespace'\n\nexport const XMLNS_NAMESPACE = 'http://www.w3.org/2000/xmlns/'\n\nexport const CNXML_NAMESPACE = 'http://cnx.rice.edu/cnxml'\n\n/** Natural language extensions to CNXML */\nexport const CMLNLE_NAMESPACE = 'http://katalysteducation.org/cmlnle/1.0'\n\nexport const CXLXT_NAMESPACE = 'http://katalysteducation.org/cxlxt/1.0'\n\n/** CNXML extensions to facilitate better editing experience */\nexport const EDITING_NAMESPACE = 'http://adaptarr.naukosfera.com/editing/1.0'\n","// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport * as Slate from 'slate'\nimport { List, MediaUse, StyledText, WithClasses } from 'cnx-designer'\nimport { Editor, Path, Text, Transforms } from 'slate'\n\nimport normalizeWhiteSpace, { collapseAdjacentText } from './whitespace'\nimport { CnxmlVersion, Document as Doc } from '.'\nimport {\n    CMLNLE_NAMESPACE, CNXML_NAMESPACE, CXLXT_NAMESPACE, EDITING_NAMESPACE, XML_NAMESPACE,\n} from './consts'\nimport { enumerate } from './util'\n\n/**\n * Editor used for deserialization\n *\n * This interface extends Slate's editor with various methods used for\n * deserialization. Those methods (as well as those of Editor) can be\n * overwritten to customize how a document is deserialized.\n */\nexport interface DeserializingEditor extends Editor {\n    errors: DeserializingError[]\n\n    /**\n     * Deserialize an element\n     *\n     * This function is passed the element to deserialize, path at which nodes\n     * it deserializes to should be inserted, and a context defining what\n     * elements were expected at this place in the document.\n     */\n    deserializeElement(el: Element, at: Path, context: Deserializers): void\n\n    /**\n     * Handle unknown element\n     *\n     * This function is called by {@link #deserializeElement} for elements which\n     * are either unknown or unexpected at a given place in document.\n     */\n    unknownElement(el: Element, at: Path, context: Deserializers): void\n\n    /**\n     * Report a deserialization problem\n     *\n     * `type` is a code describing the error and should only contain letters and\n     * hyphens. `description` contains additional information which may be used\n     * to format a user message.\n     */\n    reportError(type: string, description?: { [key: string]: unknown }): void\n\n    /** Finalize deserialization */\n    finalize(): Doc\n}\n\nexport interface DeserializingError {\n    type: string\n    [key: string]: unknown\n}\n\n/**\n * Deserialize a CNXML document from xml or a DOM tree\n *\n * The provided editor will be used for deserialization and will be modified.\n * After deserialization is complete, the editor will contain the same content\n * as the returned {@link Doc} element.\n */\nexport default function deserialize(\n    withEditor: (editor: DeserializingEditor) => DeserializingEditor,\n    xml: string | Document,\n): Doc {\n    if (typeof xml === 'string') {\n        xml = new DOMParser().parseFromString(xml, 'application/xml')\n        const [error] = xml.getElementsByName('parseerror')\n\n        if (error != null) {\n            throw new Error(`Invalid XML: ${error.textContent}`)\n        }\n    }\n\n    const root = xml.documentElement\n\n    if (root.namespaceURI !== CNXML_NAMESPACE || root.localName !== 'document') {\n        throw new Error(`Invalid XML: root element is {${root.namespaceURI}}${\n            root.localName} instead of {${CNXML_NAMESPACE}}document`)\n    }\n\n    const doc: Doc = {\n        moduleId: root.getAttribute('module-id') ?? 'new',\n        version: root.getAttribute('cnxml-version') as CnxmlVersion,\n        title: '',\n        content: [],\n    }\n\n    if (doc.version !== '0.7' && doc.version !== '0.8') {\n        throw new Error('Only CNXML 0.7 and 0.8 are supported')\n    }\n\n    if (root.hasAttributeNS(XML_NAMESPACE, 'lang')) {\n        doc.language = root.getAttributeNS(XML_NAMESPACE, 'lang')!\n    }\n\n    if (root.hasAttribute('class')) {\n        doc.classes = WithClasses.normalizeClasses([root.getAttribute('class')!])\n    }\n\n    const editor = withEditor(withDeserializingEditor(doc, Slate.createEditor()))\n\n    Editor.withoutNormalizing(editor, () => {\n        for (const child of root.children) {\n            if (child.namespaceURI !== CNXML_NAMESPACE) {\n                editor.reportError('unexpected-element', {\n                    namespace: child.namespaceURI,\n                    localName: child.localName,\n                })\n                continue\n            }\n\n            switch (child.localName) {\n            case 'metadata': continue\n\n            case 'title':\n                doc.title = child.textContent ?? ''\n                break\n\n            case 'content':\n                content(editor, child)\n                break\n\n            case 'glossary':\n                glossary(editor, child)\n                break\n\n            default:\n                editor.reportError('unexpected-element', {\n                    namespace: child.namespaceURI,\n                    localName: child.localName,\n                })\n                break\n            }\n        }\n\n        doc.content = editor.children\n    })\n\n    if (editor.children !== doc.content) {\n        editor.reportError('normalized')\n        doc.content = editor.children\n    }\n\n    return editor.finalize()\n}\n\n/**\n * Wrap a Slate editor with additional deserialization-oriented functionality\n */\nfunction withDeserializingEditor(doc: Doc, ed: Editor): DeserializingEditor {\n    const editor = ed as DeserializingEditor\n\n    editor.deserializeElement = function deserializeElement(el, at, context) {\n        if (el.namespaceURI === CNXML_NAMESPACE\n        || el.namespaceURI === EDITING_NAMESPACE) {\n            const deserializer = context[el.localName]\n\n            if (deserializer != null) {\n                return deserializer(editor, el, at)\n            }\n        }\n\n        editor.unknownElement(el, at, context)\n    }\n\n    editor.unknownElement = function unknownElement(el, at, context) {\n        if (el.namespaceURI === CNXML_NAMESPACE\n        || el.namespaceURI === EDITING_NAMESPACE) {\n            const deserializer = FALLBACK[el.localName]\n\n            if (deserializer != null) {\n                editor.reportError('unexpected-element', {\n                    namespace: el.namespaceURI,\n                    localName: el.localName,\n                    id: el.getAttribute('id'),\n                })\n                return deserializer(editor, el, at)\n            }\n        }\n\n        editor.reportError('unknown-element', {\n            namespace: el.namespaceURI,\n            localName: el.localName,\n            id: el.getAttribute('id'),\n        })\n        children(editor, el, at, context)\n    }\n\n    editor.reportError = function reportError(type, description) {\n        console.error(type, description)\n    }\n\n    editor.finalize = function finalize() {\n        return doc\n    }\n\n    return editor\n}\n\nexport type Deserializer = (editor: DeserializingEditor, el: Element, at: Path) => void\n\nexport type Deserializers = { [localName: string]: Deserializer }\n\n/**\n * Deserialize children of an element\n *\n * This function will deserialize all child nodes of el, each into a separate\n * Slate node. This means that every XML text node will produce a Slate text\n * node, and all formatting white space will be treated as content, even for\n * block elements. This should later be fixed using {@link normalizeBlock} or\n * {@link normalizeLine}.\n */\nexport function children(\n    editor: DeserializingEditor,\n    el: Element,\n    at: Path,\n    context: Deserializers,\n): void {\n    const path = Editor.pathRef(editor, at)\n\n    for (const child of el.childNodes) {\n        switch (child.nodeType) {\n        case Node.ELEMENT_NODE:\n            editor.deserializeElement(child as Element, path.current!, context)\n            break\n\n        case Node.TEXT_NODE:\n        case Node.CDATA_SECTION_NODE:\n            editor.apply({\n                type: 'insert_node',\n                path: path.current!,\n                node: { text: (child as CharacterData).data },\n            })\n            break\n        case Node.PROCESSING_INSTRUCTION_NODE:\n            editor.apply({\n                type: 'insert_node',\n                path: path.current!,\n                node: {\n                    type: 'processing_instruction',\n                    target: (child as ProcessingInstruction).target,\n                    value: (child as ProcessingInstruction).data,\n                    children: [{ text: '' }],\n                },\n            })\n            break\n\n        // Comments, etc.\n        default: break\n        }\n    }\n\n    if (el.childNodes.length === 0) {\n        editor.apply({ type: 'insert_node', path: path.current!, node: { text: '' } })\n    }\n\n    path.unref()\n}\n\n/**\n * Build an element according to a template and insert it at a path\n *\n * The template will be extended with additional properties common to all CNXML\n * elements.\n *\n * Element's children will be deserialized using {@link children}.\n */\nexport function buildElement(\n    editor: DeserializingEditor,\n    el: Element,\n    at: Path,\n    template: Partial<Slate.Element>,\n    context: Deserializers,\n): void {\n    const node: Slate.Element = { children: [], ...template }\n\n    if (el.hasAttribute('id')) {\n        node.id = el.getAttribute('id')\n    }\n\n    if (el.hasAttribute('class')) {\n        node.classes = WithClasses.normalizeClasses([el.getAttribute('class')!])\n    }\n\n    for (const [key, value] of Object.entries(node)) {\n        if (key === 'children' || key === 'text') continue\n\n        if (value == null) {\n            delete node[key]\n        }\n    }\n\n    Transforms.insertNodes(editor, node, { at })\n    children(editor, el, [...at, 0], context)\n}\n\n/**\n * Normalize a block element after deserialization.\n *\n * All inter-element white space will be removed, and non-white space text will\n * be converted into paragraphs.\n */\nexport function normalizeBlock(editor: DeserializingEditor, at: Path): void {\n    collapseAdjacentText(editor, at)\n\n    for (const [node, path] of Slate.Node.children(editor, at, { reverse: true })) {\n        if (!Text.isText(node)) continue\n\n        if (/^\\s*$/.test(node.text)) {\n            editor.apply({ type: 'remove_node', path, node })\n        } else {\n            editor.reportError('text-in-block')\n            Transforms.wrapNodes(editor, {\n                type: 'paragraph',\n                children: [],\n            }, { at: path })\n            normalizeWhiteSpace(editor, path)\n        }\n    }\n}\n\n/**\n * Normalize a line element after deserialization\n *\n * White space will be normalized (and trailing removed), and block children\n * will be unwrapped, splitting this element if necessary.\n */\nexport function normalizeLine(editor: Editor, at: Path): void {\n    const node = Slate.Node.get(editor, at) as Slate.Element\n    const hasBlocks = node.children.some(n => Slate.Element.isElement(n) && !editor.isInline(n))\n\n    if (!hasBlocks) {\n        normalizeWhiteSpace(editor, at)\n    } else {\n        const next = Path.next(at)\n        let end = node.children.length\n\n        for (const [inx, child] of enumerate(node.children, true)) {\n            if (Text.isText(child) || editor.isInline(child)) {\n                continue\n            }\n\n            if (inx + 1 < end) {\n                Transforms.splitNodes(editor, { at: [...at, inx + 1] })\n                normalizeWhiteSpace(editor, next)\n\n                const newNode = Slate.Node.get(editor, next) as Slate.Element\n                if (newNode.children.length === 1 && Text.isText(newNode.children[0])\n                && newNode.children[0].text.match(/^\\s*$/)) {\n                    Transforms.removeNodes(editor, { at: next })\n                }\n            }\n\n            Transforms.liftNodes(editor, { at: [...at, inx] })\n            end = inx\n        }\n\n        if (end > 0) {\n            normalizeWhiteSpace(editor, at)\n\n            const newNode = Slate.Node.get(editor, at) as Slate.Element\n            if (newNode.children.length === 1 && Text.isText(newNode.children[0])\n            && newNode.children[0].text.match(/^\\s*$/)) {\n                Transforms.removeNodes(editor, { at })\n            }\n        }\n    }\n}\n\n/** Normalize element which can contain either line content or block content */\nfunction normalizeMixed(editor: DeserializingEditor, at: Path) {\n    const node = Slate.Node.get(editor, at)\n\n    if (!Slate.Element.isElement(node)) {\n        throw new Error(`Cannot normalize node at path [${at}] as it is not an element`)\n    }\n\n    const line = node.children.every(\n        (n: Slate.Node) => Text.isText(n) || Editor.isInline(editor, n))\n\n    if (line) {\n        Transforms.wrapNodes(editor, {\n            type: 'paragraph',\n            children: [],\n        }, {\n            at,\n            match: n => node.children.includes(n),\n        })\n        normalizeLine(editor, [...at, 0])\n    } else {\n        normalizeBlock(editor, at)\n    }\n}\n\n/** Normalize element which shouldn't contain any children */\nexport function normalizeVoid(editor: DeserializingEditor, at: Path): void {\n    const node = Slate.Node.get(editor, at)\n\n    if (!Slate.Element.isElement(node)) {\n        throw new Error(`Cannot normalize node at path [${at}] as it is not an element`)\n    }\n\n    if (node.children.length > 0) {\n        normalizeWhiteSpace(editor, at)\n    }\n\n    if (node.children.length === 1\n    && Text.isText(node.children[0]) && node.children[0].text === '') {\n        return\n    }\n\n    if (node.children.length > 0) {\n        editor.reportError('content-in-void')\n    }\n\n    const newPath = Path.next(at)\n    for (let index = node.children.length - 1 ; index >= 0 ; --index) {\n        editor.apply({ type: 'move_node', path: [...at, index], newPath })\n    }\n\n    if (node.children.length === 0) {\n        editor.apply({ type: 'insert_node', path: [...at, 0], node: { text: '' } })\n    }\n}\n\n/** Build deserializer for block elements */\nfunction block(template: string | Partial<Slate.Element>, context: Deserializers) {\n    const node = typeof template === 'string'\n        ? { type: template }\n        : template\n\n    return function deserializer(editor: DeserializingEditor, el: Element, at: Path) {\n        buildElement(editor, el, at, node, context)\n        normalizeBlock(editor, at)\n    }\n}\n\n/** Build deserializer for line elements */\nfunction line(template: string | Partial<Slate.Element>, context?: Deserializers) {\n    const node = typeof template === 'string'\n        ? { type: template }\n        : template\n\n    return function deserializer(editor: DeserializingEditor, el: Element, at: Path) {\n        buildElement(editor, el, at, node, context ?? INLINE)\n        normalizeLine(editor, at)\n    }\n}\n\n/** Build deserializer for mixed elements */\nfunction mixed(template: string | Partial<Slate.Element>, content: Deserializers) {\n    const node = typeof template === 'string'\n        ? { type: template }\n        : template\n\n    return function deserializer(editor: DeserializingEditor, el: Element, at: Path) {\n        buildElement(editor, el, at, node, { ...INLINE, ...content })\n        normalizeMixed(editor, at)\n    }\n}\n\n/** --- deserialization contexts -------------------------------------------- */\n\n/** Deserialize a <caption> */\nconst caption = line('caption')\n\n/** Deserialize a <title> */\nconst title = line('title')\n\n/** Inline elements */\nexport const INLINE: Deserializers = {\n    code,\n    emphasis: mark,\n    footnote: line('footnote'),\n    foreign,\n    link,\n    sub: mark,\n    sup: mark,\n    term,\n    preformat,\n}\n\n/** Line elements */\nexport const LINE: Deserializers = {\n    code,\n    list,\n    para: line('paragraph'),\n    preformat,\n}\nLINE.quote = mixed('quotation', LINE)\n\n/** Deserialize a <definition> */\nconst definition = block('definition', {\n    example: block('definition_example', LINE),\n    meaning: mixed('definition_meaning', LINE),\n    seealso: block('definition_seealso', { term: definitionTerm }),\n    term: definitionTerm,\n})\n\n/** Contents of an exercise */\nconst EXERCISE = {\n    commentary: block('exercise_commentary', LINE),\n    problem: block('exercise_problem', LINE),\n    solution: block('exercise_solution', LINE),\n}\n\n/** Contents of a figure */\nconst FIGURE = {\n    caption,\n    media,\n    subfigure: block('figure', { media, caption }),\n    title,\n}\n\n/** Block elements */\nexport const BLOCK: Deserializers = {\n    ...LINE,\n    definition,\n    exercise: block('exercise', EXERCISE),\n    figure: block('figure', FIGURE),\n    note,\n    rule,\n}\n\n/** Content of most mixed elements */\nconst MIXED = { ...LINE, ...INLINE }\n\n/** Media items */\nconst MEDIA = {\n    'alt-text': line('media_alt', {}),\n    audio: mediaItem,\n    image: mediaItem,\n    video: mediaItem,\n}\n\n/** Contents of a rule */\nconst RULE = {\n    example: block('rule_example', LINE),\n    proof: block('rule_proof', LINE),\n    statement: block('rule_statement', LINE),\n    title,\n}\n\n/** Contents of a admonition */\nconst ADMONITION = {\n    ...MIXED,\n    figure: block('figure', FIGURE),\n    title,\n}\n\n/** Contents of a list */\nconst LIST = { item }\n\n/** Contents of a glossary */\nconst GLOSSARY = { definition }\n\n/** Document content */\nconst CONTENT = { ...BLOCK, section }\n\n/** Section content */\nconst SECTION = { ...CONTENT, title }\n\n/** Deserializers to use when one couldn't be found in context */\nconst FALLBACK: Deserializers = { ...INLINE, ...SECTION, ...MEDIA }\n\n/* --- deserializers -------------------------------------------------------- */\n\n/** Deserialize <code> */\nfunction code(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'code',\n        language: el.getAttribute('lang'),\n        placement: el.getAttribute('display') === 'block' ? 'block' : 'line',\n    }, INLINE)\n    // NOTE: this element contains pre-formatted content and should not be\n    // normalized.\n}\n\n/** Deserialize <content> */\nfunction content(editor: DeserializingEditor, el: Element): void {\n    children(editor, el, [0], CONTENT)\n    normalizeBlock(editor, [])\n}\n\n/** Deserialize a <term> in <definition> */\nfunction definitionTerm(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'definition_term',\n        reference: el.getAttributeNS(CMLNLE_NAMESPACE, 'reference'),\n    }, INLINE)\n    normalizeLine(editor, at)\n}\n\n/** Deserialize <foreign> */\nfunction foreign(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'foreign',\n        language: el.getAttributeNS(XML_NAMESPACE, 'lang'),\n    }, INLINE)\n    normalizeLine(editor, at)\n}\n\n/** Deserialize <glossary> */\nfunction glossary(editor: DeserializingEditor, el: Element): void {\n    const path = [editor.children.length]\n    buildElement(editor, el, path, { type: 'glossary' }, GLOSSARY)\n    normalizeBlock(editor, path)\n}\n\n/** Deserialize a list item */\nfunction item(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, { type: 'list_item' }, MIXED)\n    normalizeMixed(editor, at)\n\n    const node = Slate.Node.get(editor, at) as Slate.Element\n    if (node.children.length === 1 && List.isList(node.children[0])) {\n        Transforms.unwrapNodes(editor, { at })\n    }\n}\n\n/** Deserialize a cross-reference, a document reference, or a hyperlink */\nfunction link(editor: DeserializingEditor, el: Element, at: Path): void {\n    const target = el.getAttribute('target-id')\n    const document = el.getAttribute('document')\n    const url = el.getAttribute('url')\n\n    if (target != null) {\n        buildElement(editor, el, at, {\n            type: 'xref',\n            target,\n            document,\n            case: el.getAttributeNS(CMLNLE_NAMESPACE, 'case'),\n            children: [],\n        }, {})\n        normalizeVoid(editor, at)\n    } else if (url != null) {\n        buildElement(editor, el, at, { type: 'link', url }, INLINE)\n        normalizeLine(editor, at)\n    } else if (document != null) {\n        buildElement(editor, el, at, { type: 'docref', document }, INLINE)\n        normalizeLine(editor, at)\n    } else {\n        editor.reportError('link-missing-target')\n        children(editor, el, at, INLINE)\n    }\n}\n\nfunction list(editor: DeserializingEditor, el: Element, at: Path): void {\n    const props = el.getAttribute('list-type') === 'enumerated'\n        ? {\n            type: 'list',\n            style: 'enumerated',\n            numberStyle: el.getAttribute('number-style') ?? 'arabic',\n            start: Number(el.getAttribute('start-value') ?? 1),\n        }\n        : {\n            type: 'list',\n            style: 'bulleted',\n            bullet: el.getAttribute('bullet') ?? 'bullet',\n        }\n\n    buildElement(editor, el, at, props, LIST)\n    normalizeBlock(editor, at)\n}\n\nconst MARKS: { [key: string]: Omit<StyledText, 'text'> } = {\n    sub: { position: 'subscript' },\n    sup: { position: 'superscript' },\n    bold: { strong: true },\n    underline: { underline: true },\n    italics: { emphasis: true },\n}\n\n/** Deserialize a styling element */\nfunction mark(editor: DeserializingEditor, el: Element, at: Path): void {\n    const mark = el.localName === 'emphasis'\n        ? el.getAttribute('effect') ?? 'bold'\n        : el.localName\n    const props = MARKS[mark]\n    const end = Editor.pathRef(editor, at)\n\n    children(editor, el, at, INLINE)\n\n    if (props != null) {\n        Transforms.setNodes(editor, props, {\n            at: Editor.range(editor, at, Path.previous(end.current!)),\n            match: Text.isText,\n        })\n    }\n\n    end.unref()\n}\n\n/** Deserialize media container */\nfunction media(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, { type: 'media' }, MEDIA)\n\n    const node = Slate.Node.get(editor, at) as Slate.Element\n\n    if (!node.children.some((n: Slate.Node) => n.type === 'media_alt')\n    && el.hasAttribute('alt')) {\n        const path = [...at, node.children.length]\n        editor.apply({\n            type: 'insert_node',\n            path,\n            node: {\n                type: 'media_alt',\n                children: [{ text: el.getAttribute('alt')! }],\n            },\n        })\n        normalizeWhiteSpace(editor, path)\n    }\n\n    normalizeBlock(editor, at)\n}\n\n/** Deserialize a media item */\nfunction mediaItem(editor: DeserializingEditor, el: Element, at: Path): void {\n    const use = el.getAttribute('for')\n\n    buildElement(editor, el, at, {\n        type: 'media_' + el.localName,\n        src: el.getAttribute('src'),\n        intendedUse: MediaUse.isMediaUse(use) ? use : 'all',\n    }, {})\n\n    normalizeVoid(editor, at)\n}\n\n/** Deserialize an admonition */\nfunction note(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'admonition',\n        kind: el.getAttribute('type') ?? 'note',\n    }, ADMONITION)\n    normalizeMixed(editor, at)\n}\n\n/** Deserialize <preformat> */\nfunction preformat(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, { type: 'preformat' }, INLINE)\n    // NOTE: this element contains pre-formatted content and should not be\n    // normalized.\n}\n\n/** Deserialize a rule */\nfunction rule(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'rule',\n        kind: el.getAttribute('type') ?? 'rule',\n    }, RULE)\n    normalizeBlock(editor, at)\n}\n\n/** Deserialize a <section> */\nfunction section(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, { type: 'section' }, SECTION)\n    normalizeBlock(editor, at)\n}\n\n/** Deserialize a <term> */\nfunction term(editor: DeserializingEditor, el: Element, at: Path): void {\n    buildElement(editor, el, at, {\n        type: 'term',\n        index: el.getAttributeNS(CXLXT_NAMESPACE, 'index'),\n        reference: el.getAttributeNS(CMLNLE_NAMESPACE, 'reference'),\n        name: el.getAttributeNS(CXLXT_NAMESPACE, 'name'),\n        born: el.hasAttributeNS(CXLXT_NAMESPACE, 'born')\n            ? Number(el.getAttributeNS(CXLXT_NAMESPACE, 'born'))\n            : undefined,\n        died: el.hasAttributeNS(CXLXT_NAMESPACE, 'died')\n            ? Number(el.getAttributeNS(CXLXT_NAMESPACE, 'died'))\n            : undefined,\n    }, INLINE)\n    normalizeLine(editor, at)\n}\n","// Copyright 2021 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport { CNXML, Editing } from './cnxml'\nimport { Node } from './render'\n\nexport interface IntrinsicAttributes {\n    xmlns?: string\n    xmlLang?: string\n    children?: Node\n}\n\nexport interface IntrinsicElements {\n    'cite-title': IntrinsicAttributes & CNXML.Cite\n    'alt-text': IntrinsicAttributes & Editing.AltText\n    audio: IntrinsicAttributes & CNXML.Audio\n    caption: IntrinsicAttributes & CNXML.Caption\n    cite: IntrinsicAttributes & CNXML.Cite\n    code: IntrinsicAttributes & CNXML.Code\n    commentary: IntrinsicAttributes & CNXML.Commentary\n    content: IntrinsicAttributes & CNXML.Content\n    definition: IntrinsicAttributes & CNXML.Definition\n    document: IntrinsicAttributes & CNXML.Document\n    download: IntrinsicAttributes & CNXML.Download\n    emphasis: IntrinsicAttributes & CNXML.Emphasis\n    equation: IntrinsicAttributes & CNXML.Equation\n    example: IntrinsicAttributes & CNXML.Example\n    exercise: IntrinsicAttributes & CNXML.Exercise\n    figure: IntrinsicAttributes & CNXML.Figure\n    flash: IntrinsicAttributes & CNXML.Flash\n    footnote: IntrinsicAttributes & CNXML.Footnote\n    foreign: IntrinsicAttributes & CNXML.Foreign\n    glossary: IntrinsicAttributes & CNXML.Glossary\n    image: IntrinsicAttributes & CNXML.Image\n    item: IntrinsicAttributes & CNXML.Item\n    'java-applet': IntrinsicAttributes & CNXML.JavaApplet\n    label: IntrinsicAttributes & CNXML.Label\n    labview: IntrinsicAttributes & CNXML.Labview\n    link: IntrinsicAttributes & CNXML.Link\n    list: IntrinsicAttributes & CNXML.List\n    meaning: IntrinsicAttributes & CNXML.Meaning\n    media: IntrinsicAttributes & CNXML.Media\n    newline: IntrinsicAttributes & CNXML.Newline\n    note: IntrinsicAttributes & CNXML.Note\n    para: IntrinsicAttributes & CNXML.Para\n    param: IntrinsicAttributes & CNXML.Param\n    pi: IntrinsicAttributes & CNXML.ProcesingInstruction\n    preformat: IntrinsicAttributes & CNXML.Preformat\n    problem: IntrinsicAttributes & CNXML.Problem\n    proof: IntrinsicAttributes & CNXML.Proof\n    quote: IntrinsicAttributes & CNXML.Quote\n    rule: IntrinsicAttributes & CNXML.Rule\n    section: IntrinsicAttributes & CNXML.Section\n    seealso: IntrinsicAttributes & CNXML.SeeAlso\n    solution: IntrinsicAttributes & CNXML.Solution\n    space: IntrinsicAttributes & CNXML.Space\n    statement: IntrinsicAttributes & CNXML.Statement\n    sub: IntrinsicAttributes & CNXML.Sub\n    subfigure: IntrinsicAttributes & CNXML.Subfigure\n    sup: IntrinsicAttributes & CNXML.Sup\n    term: IntrinsicAttributes & CNXML.Term\n    title: IntrinsicAttributes & CNXML.Title\n    video: IntrinsicAttributes & CNXML.Video\n}\n","// Copyright 2021 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport * as JSX from './jsx'\nimport { Attributes, Element, Node } from './render'\n\nexport * as JSX from './jsx'\n\n/** Old-style JSX factory */\nexport function createElement<\n    K extends keyof JSX.IntrinsicElements,\n    A extends JSX.IntrinsicAttributes,\n>(\n    name: K,\n    attrs: A | null,\n    ...children: Node[]\n): Element {\n    const { xmlns, ...attributes } = attrs ?? ({} as Attributes)\n\n    return {\n        name: { namespace: xmlns, local: name },\n        attributes,\n        children,\n    }\n}\n\n/** New-style JSX factory */\nexport function jsx<\n    K extends keyof JSX.IntrinsicElements,\n    A extends JSX.IntrinsicAttributes,\n>(name: K, props: A): Element {\n    const { xmlns, children, ...attributes } = props\n\n    return {\n        name: { namespace: xmlns, local: name },\n        attributes,\n        children: children ?? [],\n    }\n}\n\nexport const jsxs = jsx\n","// Copyright 2021 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport { isPlainObject } from 'is-plain-object'\n\nimport * as JSX from './jsx'\nimport {\n    CMLNLE_NAMESPACE, CNXML_NAMESPACE, CXLXT_NAMESPACE, EDITING_NAMESPACE, XML_NAMESPACE,\n    XMLNS_NAMESPACE,\n} from './consts'\n\n/** Qualified name of an element or attribute */\nexport interface Name {\n    /**\n     * Namespace\n     *\n     * When omitted for an element name it is inherited form the parent element.\n     * When omitted for an attribute, the name refers to the default namespace.\n     */\n    namespace?: string\n    /** Local name */\n    local: string\n}\n\n/** An element */\nexport interface Element {\n    /** Element's name */\n    name: Name\n    /** Attributes set on this element */\n    attributes: Attributes\n    /** Children nodes */\n    children: Node\n}\n\nexport type Attributes = Omit<JSX.IntrinsicAttributes, 'children'> & { [key: string]: unknown }\n\n/** A processing instruction */\nexport interface ProcessingInstruction {\n    /** PI's target */\n    target: string\n    /** PI's value */\n    value: string\n}\n\n/** Any value that can be used as child of a JSX element */\nexport type Node = Element | ProcessingInstruction | globalThis.Node | string | Node[] | null\n\nexport const Node = {\n    isElement(node: Node): node is Element {\n        return isPlainObject(node) && typeof (node as Element).name === 'object'\n    },\n    isProcessingInstruction(node: Node): node is ProcessingInstruction {\n        return node != null && typeof (node as ProcessingInstruction).target === 'string'\n    },\n}\n\n/** Mapping from XML prefixes to namespace URIs */\nconst NAMESPACE_PREFIXES: { [prefix: string]: string } = {\n    xml: XML_NAMESPACE,\n    cmlnle: CMLNLE_NAMESPACE,\n    cxlxt: CXLXT_NAMESPACE,\n    editing: EDITING_NAMESPACE,\n}\n\ninterface Renderer {\n    namespace: string | null\n    doc: Document\n    depth: number\n}\n\n/** Render a JSX element into an XML document */\nexport function render(root: Element): Document {\n    const namespace = root.name.namespace\n    const doc = document.implementation.createDocument(\n        namespace ?? null, root.name.local, null)\n    const renderer = { namespace: namespace ?? null, doc, depth: 0 }\n\n    for (const [prefix, uri] of Object.entries(NAMESPACE_PREFIXES)) {\n        if (uri === XML_NAMESPACE) continue\n\n        doc.documentElement.setAttributeNS(XMLNS_NAMESPACE, `xmlns:${prefix}`, uri)\n    }\n\n    finishElement(renderer, root, doc.documentElement)\n\n    return doc\n}\n\n/** Render a JSX element into an XML element */\nfunction renderElement(renderer: Renderer, element: Element): globalThis.Element {\n    const ns = element.name.namespace ?? renderer.namespace\n    const el = renderer.doc.createElementNS(ns, element.name.local)\n\n    finishElement(renderer, element, el)\n\n    return el\n}\n\n/** CNXML tags which contain only block and can be safely formatted */\n/* eslint-disable array-element-newline */\nconst BLOCK_TAGS = [\n    'commentary', 'content', 'definition', 'document', 'example', 'exercise',\n    'figure', 'glossary', 'item', 'list', 'meaning', 'media', 'note', 'problem',\n    'proof', 'quote', 'rule', 'section', 'seealso', 'solution', 'statement',\n    'subfigure',\n]\n/* eslint-enable array-element-newline */\n\n/**\n * Attributes added for ex. when transforming from JSX to HTML.\n * We want to omit them.\n */\nconst RESERVED_ATTRIBUTES = [\n    '__self', // Value of this when evaluation the JSX expression\n    '__source', // Location of JSX expression in the source\n]\n\n/** Finish rendering an already created element */\nfunction finishElement(renderer: Renderer, element: Element, out: globalThis.Element): void {\n    for (const [key, value] of Object.entries(element.attributes)) {\n        if (RESERVED_ATTRIBUTES.includes(key)) continue\n        if (value == null) continue\n\n        let val\n\n        switch (typeof value) {\n        case 'string':\n            val = value\n            break\n\n        case 'object':\n        case 'boolean':\n        case 'number':\n        case 'bigint':\n            val = value!.toString()\n            break\n\n        default:\n            continue\n        }\n\n        const r = key.match(/([a-z]+)([A-Z][a-z]*)/)\n        if (r) {\n            const [, prefix, attr] = r\n            const ns = NAMESPACE_PREFIXES[prefix]\n\n            if (ns == null) {\n                throw new Error(\n                    `unknown namespace prefix ${prefix} for attribute ${key}`)\n            }\n\n            out.setAttributeNS(ns, attr.toLowerCase(), val.toString())\n        } else {\n            out.setAttribute(key, val.toString())\n        }\n    }\n\n    const depth = renderer.depth + 1\n    const indent = out.namespaceURI === CNXML_NAMESPACE && BLOCK_TAGS.includes(out.tagName)\n        ? '\\n' + '  '.repeat(depth)\n        : null\n    const r = {\n        ...renderer,\n        depth,\n        namespace: element.name.namespace ?? renderer.namespace,\n    }\n\n    let count = 0\n\n    function renderChild(child: Node): void {\n        if (child == null) return\n\n        if (Array.isArray(child)) {\n            for (const node of child) {\n                renderChild(node)\n            }\n            return\n        }\n\n        if (indent != null) {\n            out.append(indent)\n        }\n\n        if (child instanceof globalThis.Node) {\n            out.append(renderer.doc.importNode(child, true))\n        } else if (typeof child === 'string') {\n            out.append(child)\n        } else if (Node.isProcessingInstruction(child)) {\n            out.append(document.createProcessingInstruction(child.target, child.value))\n        } else {\n            out.append(renderElement(r, child))\n        }\n\n        count += 1\n    }\n\n    renderChild(element.children)\n\n    if (count > 0 && indent != null) {\n        out.append('\\n' + '  '.repeat(renderer.depth))\n    }\n}\n","// Copyright 2020 OpenStax Poland\n// Licensed under the MIT license. See LICENSE file in the project root for\n// full license text.\n\nimport {\n    Admonition, AltText, Audio, Caption, Code, Commentary, CrossReference,\n    Definition, DefinitionExample, DefinitionTerm, DocumentReference, Exercise,\n    Figure, Footnote, Foreign, Glossary, Image, Link, List, ListItem, Meaning,\n    Media, MediaData, NameTerm, NumberStyle, Paragraph, Preformat, Problem,\n    ProcessingInstruction, Proof, Quotation, Rule, RuleExample, Section, SeeAlso, Solution,\n    Statement, StyledText, Term, Title, Video, WithClasses,\n} from 'cnx-designer'\nimport { Editor, Element, Node, Text } from 'slate'\n\nimport { CNXML_NAMESPACE, EDITING_NAMESPACE } from './consts'\nimport { CXLXT } from './cnxml'\nimport { render, Node as RenderNode } from './render'\nimport { uuid } from './util'\nimport { Document as Doc } from '.'\n\n/** Serialization options */\nexport interface Options<Format> {\n    /** Format to which to serialize */\n    format: Format\n    /** Function used to determine the MIME type of a media item */\n    mediaMime: MediaMimeFunction\n    /** Function used to serialize custom nodes */\n    serializeNode?: PartialSerializer\n}\n\n/** Function used to determine the MIME type of a media item */\nexport type MediaMimeFunction = (media: MediaData) => string\n\n/**\n * Function used to serialize custom nodes\n *\n * If provided, the serialization routine will first consult this function. If\n * a non-null value is returned it will be used as node's serialization.\n * Otherwise serialization will proceed as if this function wasn't provided.\n */\nexport type PartialSerializer =\n    (node: Node, attrs: CommonAttrs, children: RenderNode, ctx: Context) => RenderNode\n\n/* eslint-disable import/export -- see eslint-plugin-import#1590 */\nexport default function serialize(\n    editor: Editor, document: Doc, options: Options<'xml'>): string\nexport default function serialize(\n    editor: Editor, document: Doc, options: Options<'dom'>): Document\n\n/** Serialize a document to CNXML */\nexport default function serialize(\n    editor: Editor,\n    doc: Doc,\n    options: Options<'xml' | 'dom'>,\n): string | Document {\n    const { format, mediaMime } = options\n    const context = {\n        mediaMime,\n        serializeNode: options.serializeNode,\n    }\n\n    const content = doc.content.map(n => serializeNode(editor, n, context))\n    const glossary = Glossary.isGlossary(doc.content[doc.content.length - 1])\n        ? content.pop()!\n        : null\n\n    const document = render(<document\n        xmlns={CNXML_NAMESPACE}\n        cnxml-version={doc.version}\n        id={doc.moduleId}\n        module-id={doc.moduleId}\n        xmlLang={doc.language}\n        class={doc.classes?.join(' ')}\n        >\n        <title>{doc.title}</title>\n        <content>\n            {content}\n        </content>\n        {glossary}\n    </document>)\n\n    if (format === 'dom') {\n        return document\n    }\n\n    let x = new XMLSerializer().serializeToString(document)\n\n    // Some browsers serialize XML without declaration.\n    if (!x.startsWith('<?xml')) {\n        x = `<?xml version=\"1.0\" encoding=\"${document.characterSet}\"?>\\n${x}`\n    }\n\n    return x\n}\n/* eslint-enable import/export */\n\n/** Serialization context */\nexport interface Context {\n    mediaMime: MediaMimeFunction\n    serializeNode?: PartialSerializer\n}\n\n/** Attributes common to all elements */\nexport interface CommonAttrs {\n    /** Element's ID */\n    id: string\n    /** CSS classes */\n    class?: string\n}\n\n/** Serialize a single node */\nfunction serializeNode(editor: Editor, node: Node, ctx: Context): RenderNode {\n    if (Text.isText(node)) {\n        let n: RenderNode = node.text\n\n        for (const style of STYLES) {\n            if (style in node) {\n                n = applyTextStyle(style, node[style] as string | boolean, n)\n            }\n        }\n\n        return n\n    }\n\n    const children = Editor.hasInlines(editor, node)\n        ? serializeLine(editor, node, ctx)\n        : node.children.map(n => serializeNode(editor, n, ctx))\n\n    const attributes: CommonAttrs = {\n        id: node.id as string || `UUID${uuid.v4()}`,\n    }\n\n    if (WithClasses.hasClasses(node)) {\n        attributes.class = node.classes.join(' ')\n    }\n\n    if (ctx.serializeNode != null) {\n        const n = ctx.serializeNode(node, attributes, children, ctx)\n        if (n != null) {\n            return n\n        }\n    }\n\n    for (const [test, serializer] of SERIALIZERS) {\n        if (test(node)) {\n            return serializer(node, attributes, children, ctx)\n        }\n    }\n\n    throw new Error(`no serializer defined for ${JSON.stringify(node)}`)\n}\n\n/** Check if a node contains only plain, unmarked text */\nfunction isPlainText(node: Node): boolean {\n    if (Element.isElement(node)) {\n        return node.children.every(isPlainText)\n    }\n\n    const text = node as StyledText\n\n    return !text.emphasis\n        && !text.strong\n        && (text.position == null || text.position === 'normal')\n}\n\n/** Name of a style attribute on a {@link StyledText} node */\ntype TextStyle = 'emphasis' | 'underline' | 'strong' | 'position'\n\nconst STYLES: TextStyle[] = ['emphasis', 'underline', 'strong', 'position']\n\n/** Map storing values of style attributes of a {@link StyledText} node */\ntype Style = Map<TextStyle, string | boolean>\n\n/** Apply a single text style to a rendered inline node or text */\nfunction applyTextStyle(style: TextStyle, value: string | boolean, node: RenderNode): RenderNode {\n    switch (style) {\n    case 'emphasis':\n        return value\n            ? <emphasis xmlns={CNXML_NAMESPACE} effect=\"italics\">{node}</emphasis>\n            : node\n\n    case 'strong':\n        return value\n            ? <emphasis xmlns={CNXML_NAMESPACE} effect=\"bold\">{node}</emphasis>\n            : node\n\n    case 'underline':\n        return value\n            ? <emphasis xmlns={CNXML_NAMESPACE} effect=\"underline\">{node}</emphasis>\n            : node\n\n    case 'position':\n        return value === 'superscript'\n            ? <sup xmlns={CNXML_NAMESPACE}>{node}</sup>\n            : value === 'subscript'\n                ? <sub xmlns={CNXML_NAMESPACE}>{node}</sub>\n                : node\n    }\n}\n\n/** Apply collection of text styles to a rendered inline node or text */\nfunction applyStyle(styles: Style, node: RenderNode): RenderNode {\n    for (const [style, value] of styles) {\n        node = applyTextStyle(style, value, node)\n    }\n\n    return node\n}\n\n/** Serialize a single line of text */\nfunction serializeLine(editor: Editor, node: Element, ctx: Context): RenderNode {\n    const out: RenderNode[] = []\n    const text: [Style, RenderNode[]][] = [[new Map(), []]]\n\n    /** Flush all accumulated text into output */\n    function flush(): void {\n        while (text.length > 1) {\n            const [style, nodes] = text.pop()!\n            text[text.length - 1][1].push(applyStyle(style, nodes))\n        }\n\n        const [style, nodes] = text.pop()!\n        text.push([new Map(), []])\n\n        out.push(applyStyle(style, nodes))\n    }\n\n    /** Collapse style stack below certain depth */\n    function collapse(from: number): void {\n        for (let i = text.length - 1 ; i > from ; --i) {\n            const [style, nodes] = text[i]\n\n            if (nodes.length > 0) {\n                text[i - 1][1].push(applyStyle(style, nodes))\n                text[i][1] = []\n            }\n        }\n    }\n\n    /** Apply style to all future text */\n    function changeStyle(changed: Style): void {\n        const keep = new Set()\n\n        // Remove from changed any styles which are already present on\n        // the stack.\n        for (const [style] of text) {\n            for (const [name, value] of style) {\n                if (changed.has(name) && changed.get(name) === value) {\n                    changed.delete(name)\n                    keep.add(name)\n                }\n            }\n        }\n\n        // Then remove from the stack any unwanted styles.\n        for (let i = text.length - 1 ; i >= 0 ; --i) {\n            const [style] = text[i]\n\n            for (const [name, value] of style) {\n                // Since we want to keep each style in only one stack entry,\n                // this check is necessary to prevent styles we want to keep\n                // from being collapsed (as since they were removed from changed\n                // the next if would consider them unwanted).\n                if (keep.has(name)) continue\n\n                if (!changed.has(name) || changed.get(name) !== value) {\n                    collapse(i)\n                    text[i][1] = [applyTextStyle(name, value, text[i][1])]\n                    style.delete(name)\n                }\n            }\n\n            // If all styles at this depth were removed, drop this entry.\n            if (style.size === 0 && i > 0) {\n                collapse(i)\n                text[i - 1][1].push(...text[i][1])\n                text.splice(i, 1)\n            }\n        }\n\n        if (changed.size > 0) {\n            text.push([changed, []])\n        }\n    }\n\n    for (const child of node.children) {\n        if (!Text.isText(child)) {\n            flush()\n            out.push(serializeNode(editor, child, ctx))\n            continue\n        }\n\n        const style = new Map()\n        for (const k of STYLES) {\n            if (k in child) {\n                style.set(k, child[k])\n            }\n        }\n\n        changeStyle(style)\n        text[text.length - 1][1].push(child.text)\n    }\n\n    flush()\n    return out\n}\n\n/** Function serializing a node to a CNXML element */\ntype Serializer<T extends Node> =\n    (node: T, attrs: CommonAttrs, children: RenderNode, ctx: Context) => RenderNode\n\ntype SerializerEntry<T extends Node> = [(node: Node) => node is T, Serializer<T>]\n\n/**\n * Node serializers\n *\n * The first element of each entry is a node matcher, the second is a serializer\n * function. {@link serializeNode} will use serializer function of the first\n * entry whose matcher function returned true.\n */\nconst SERIALIZERS: SerializerEntry<Node>[] = [\n    [Admonition.isAdmonition, admonition],\n    [AltText.isAltText, altText],\n    [Audio.isAudio, mediaItem],\n    [Caption.isCaption, makeSerializer('caption')],\n    [Code.isCode, code],\n    [Commentary.isCommentary, makeSerializer('commentary')],\n    [CrossReference.isCrossReference, xref],\n    [Definition.isDefinition, makeSerializer('definition')],\n    [DefinitionExample.isDefinitionExample, makeSerializer('example')],\n    [DefinitionTerm.isDefinitionTerm, term],\n    [DocumentReference.isDocumentReference, docref],\n    [Exercise.isExercise, makeSerializer('exercise')],\n    [Figure.isFigure, figure],\n    [Footnote.isFootnote, makeSerializer('footnote')],\n    [Foreign.isForeign, foreign],\n    [Glossary.isGlossary, makeSerializer('glossary')],\n    [Image.isImage, mediaItem],\n    [Link.isLink, link],\n    [List.isList, list],\n    [ListItem.isListItem, makeSerializer('item')],\n    [Meaning.isMeaning, makeSerializer('meaning')],\n    [Media.isMedia, media],\n    [Paragraph.isParagraph, makeSerializer('para')],\n    [Preformat.isPreformat, makeSerializer('preformat')],\n    [ProcessingInstruction.isProcessingInstruction, processingInstruction],\n    [Problem.isProblem, makeSerializer('problem')],\n    [Proof.isProof, makeSerializer('proof')],\n    [Quotation.isQuotation, makeSerializer('quote')],\n    [Rule.isRule, rule],\n    [RuleExample.isRuleExample, makeSerializer('example')],\n    [Section.isSection, makeSerializer('section')],\n    [SeeAlso.isSeeAlso, makeSerializer('seealso')],\n    [Solution.isSolution, makeSerializer('solution')],\n    [Statement.isStatement, makeSerializer('statement')],\n    [Term.isTerm, term],\n    [Title.isTitle, makeSerializer('title')],\n    [Video.isVideo, mediaItem],\n// XXX: what we'd like to do is type this array as\n// (<T extends Node> SerializerEntry<T>)[], but since such types aren't\n// currently supported we need this cast.\n] as SerializerEntry<Node>[]\n\n/** Create a serializer to a given tag from a given namespace */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction makeSerializer(Tag: string, namespace: string = CNXML_NAMESPACE) {\n    return function serializer(node: Node, attrs: CommonAttrs, children: RenderNode): RenderNode {\n        return <Tag xmlns={namespace} {...attrs}>{ children }</Tag>\n    }\n}\n\nfunction admonition(node: Admonition, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <note xmlns={CNXML_NAMESPACE} type={node.kind} {...attrs}>{children}</note>\n}\n\nfunction altText(node: AltText, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    // If alt-text contains only plain text it will be instead emitted in an\n    // alt attribute on a <media> element.\n    if (isPlainText(node)) {\n        return null\n    }\n\n    return <alt-text xmlns={EDITING_NAMESPACE} {...attrs}>{children}</alt-text>\n}\n\nfunction code(node: Element & Code, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <code\n        xmlns={CNXML_NAMESPACE}\n        display={node.placement === 'block' ? 'block' : undefined}\n        lang={node.language}\n        {...attrs}\n        >\n        {children}\n    </code>\n}\n\nfunction docref(node: DocumentReference, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <link xmlns={CNXML_NAMESPACE} document={node.document} {...attrs}>{ children }</link>\n}\n\nfunction figure(node: Figure, attrs: CommonAttrs, children: RenderNode[]): RenderNode {\n    function mapChild(child: RenderNode): RenderNode {\n        if (Array.isArray(child)) {\n            return child.map(mapChild)\n        }\n\n        if (!RenderNode.isElement(child)) {\n            return child\n        }\n\n        if (child.name.namespace === CNXML_NAMESPACE\n        && child.name.local === 'figure') {\n            return {\n                ...child,\n                name: {\n                    namespace: CNXML_NAMESPACE,\n                    local: 'subfigure',\n                },\n            }\n        }\n\n        return child\n    }\n\n    return <figure xmlns={CNXML_NAMESPACE} {...attrs}>\n        {mapChild(children)}\n    </figure>\n}\n\nfunction foreign(node: Foreign, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <foreign xmlns={CNXML_NAMESPACE} xmlLang={node.language} {...attrs}>\n        { children }\n    </foreign>\n}\n\nfunction link(node: Link, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <link xmlns={CNXML_NAMESPACE} url={node.url} {...attrs}>{ children }</link>\n}\n\nfunction list(node: List, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    function mapChild(child: RenderNode): RenderNode {\n        if (Array.isArray(child)) return child.map(mapChild)\n\n        if (!RenderNode.isElement(child)) {\n            return child\n        }\n\n        if ((child.name.namespace == null || child.name.namespace === CNXML_NAMESPACE)\n        && child.name.local === 'list') {\n            return <item xmlns={CNXML_NAMESPACE}>{child}</item>\n        }\n\n        return child\n    }\n\n    return <list\n        xmlns={CNXML_NAMESPACE}\n        list-type={node.style === 'enumerated' ? node.style : undefined}\n        bullet-style={(node.bullet !== 'bullet' ? node.bullet : undefined) as string}\n        number-style={(node.numberStyle !== 'arabic' ? node.numberStyle : undefined) as NumberStyle}\n        start-value={(node.start !== 1 ? node.start : undefined) as number}\n        {...attrs}\n        >\n        {mapChild(children)}\n    </list>\n}\n\nfunction media(node: Media, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    let alt: string\n\n    const altNode = node.children.find(n => AltText.isAltText(n))\n    if (altNode != null && isPlainText(altNode)) {\n        alt = Node.string(altNode)\n    }\n\n    return <media xmlns={CNXML_NAMESPACE} alt={alt!} {...attrs}>{children}</media>\n}\n\nfunction mediaItem(\n    node: Audio | Image | Video,\n    attrs: CommonAttrs,\n    children: RenderNode,\n    ctx: Context,\n): RenderNode {\n    const Tag = node.type.slice(6) as 'audio' | 'image' | 'video'\n\n    return <Tag\n        xmlns={CNXML_NAMESPACE}\n        src={node.src}\n        mime-type={ctx.mediaMime(node)}\n        for={node.intendedUse === 'all' ? undefined : node.intendedUse}\n        {...attrs}\n        >\n        {children}\n    </Tag>\n}\n\nfunction processingInstruction(node: ProcessingInstruction): RenderNode {\n    return { target: node.target, value: node.value }\n}\n\nfunction rule(node: Rule, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <rule\n        xmlns={CNXML_NAMESPACE}\n        type={node.kind === 'rule' ? undefined : node.kind}\n        {...attrs}>\n        {children}\n    </rule>\n}\n\nfunction term(node: Term | NameTerm, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    const nameIndexAttributes: CXLXT.Attributes.NameIndex = {}\n\n    if (Term.isNameTerm(node)) {\n        nameIndexAttributes.cxlxtName = node.name\n        nameIndexAttributes.cxlxtBorn = node.born\n        nameIndexAttributes.cxlxtDied = node.died\n    }\n\n    return <term\n        xmlns={CNXML_NAMESPACE}\n        cxlxtIndex={node.index}\n        cmlnleReference={node.reference}\n        {...nameIndexAttributes}\n        {...attrs}>\n        { children }\n    </term>\n}\n\nfunction xref(node: CrossReference, attrs: CommonAttrs, children: RenderNode): RenderNode {\n    return <link\n        xmlns={CNXML_NAMESPACE}\n        target-id={node.target}\n        document={node.document ?? undefined}\n        cmlnleCase={node.case}\n        {...attrs}\n        >\n        {children}\n    </link>\n}\n"],"names":["isPlainText","Node","code","foreign","link","term","list","media","rule","mediaItem","_jsxs","_jsx","uuid.v4","RenderNode"],"mappings":";;;;;AAAA;AACA;AACA;AAEA,MAAM,CAAC,GAAG,IAAI,UAAU,CAAC,EAAE,CAAC,CAAA;AAE5B,SAAS,CAAC,CAAC,KAAa,EAAE,GAAW;IACjC,OAAO,KAAK,CAAC,IAAI,CACb,CAAC,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,CAAC,EACtB,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CACvC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;AACd,CAAC;SAEe,EAAE;IACd,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC,CAAA;IAChC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAA;IAC3B,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAA;IAC3B,OAAO,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAA;AACtE;;AClBA;AACA;AACA;AAEA;UACyB,SAAS,CAAI,IAAiB,EAAE,OAAiB;IACtE,IAAI,OAAO,EAAE;QACT,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACrB,KAAK,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAG,KAAK,IAAI,CAAC,EAAG,EAAE,KAAK,EAAE;gBACrD,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;aAC7B;SACJ;aAAM;YACH,OAAO,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAAA;SAC3C;QACD,OAAM;KACT;IAED,IAAI,KAAK,GAAG,CAAC,CAAA;IAEb,KAAK,MAAM,KAAK,IAAI,IAAI,EAAE;QACtB,MAAM,CAAC,KAAK,EAAE,EAAE,KAAK,CAAC,CAAA;KACzB;AACL;;ACtBA;AAOA,MAAM,gBAAgB,GAAG,CAAC,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAA;AAEnE;SACwBA,aAAW,CAAC,IAAU;IAC1C,IAAI,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;QACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAACA,aAAW,CAAC,CAAA;KAC1C;IAED,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,gBAAgB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;QACjE,OAAO,KAAK,CAAA;KACf;IAED,MAAM,IAAI,GAAG,IAAkB,CAAA;IAE/B,OAAO,CAAC,IAAI,CAAC,QAAQ;WACd,CAAC,IAAI,CAAC,MAAM;YACX,IAAI,CAAC,QAAQ,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAA;AAChE;;ACxBA;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SAyDwB,mBAAmB,CAAC,MAAc,EAAE,EAAQ;IAChE,MAAM,IAAI,GAAGC,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEjC,MAAM,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,GAAG,QAAQ,GAAG,MAAM,CAAA;IAC9D,uBAAuB,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,CAAA;IAE7C,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC/B,CAAC;AAED;;;;;AAKA,SAAS,uBAAuB,CAC5B,MAAc,EACd,OAGC;IAED,MAAM,EAAE,EAAE,EAAE,IAAI,GAAG,MAAM,EAAE,GAAG,OAAO,CAAA;IACrC,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;;;IAI3C,KAAK,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,IAAIA,MAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAQ,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE;;QAErF,IAAI,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;YAC1B,uBAAuB,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAA;YAC7D,SAAQ;SACX;QAED,IAAID,aAAW,CAAC,KAAK,CAAC,EAAE;YACpB,SAAQ;SACX;QAED,MAAM,GAAG,MAAM,IAAI,KAAK,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAE,CAAA;QAElE,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YAClB,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE;gBAC1B,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE;gBACtD,KAAK,EAAE,IAAI,CAAC,MAAM;aACrB,CAAC,CAAA;YACF,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;SAC7E;QAED,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;YACnB,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE;gBAC1B,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE;gBACnC,KAAK,EAAE,IAAI,CAAC,MAAM;aACrB,CAAC,CAAA;YACF,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,CAAA;SAClE;KACJ;;;IAKD,MAAM,GAAG,GAAG,sBAAsB,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,OAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAA;IAEtF,IAAI,GAAG,IAAI,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,OAAQ,CAAC,EAAE;QAC9D,IAAI,IAAI,KAAK,QAAQ,EAAE;YACnB,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAA;YAC5E,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE;gBACzB,EAAE,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,OAAQ,CAAC;gBAChE,KAAK,EAAE,IAAI,CAAC,MAAM;aACrB,CAAC,CAAA;SACL;aAAM;YACH,UAAU,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;SAClF;KACJ;IAED,MAAM,KAAK,GAAG,sBAAsB,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,OAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAA;IAE1F,IAAI,KAAK,IAAI,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,QAAQ,CAAC,OAAQ,CAAC,EAAE;QACpE,IAAI,IAAI,KAAK,QAAQ,EAAE;YACnB,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAA;YAC9E,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE;gBACzB,EAAE,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAQ,EAAE,KAAK,CAAC;gBAClD,KAAK,EAAE,IAAI,CAAC,MAAM;aACrB,CAAC,CAAA;SACL;aAAM;YACH,UAAU,CAAC,MAAM,CAAC,MAAM,EAAE;gBACtB,EAAE,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAQ,EAAE,KAAK,CAAC;gBAClD,OAAO,EAAE,IAAI;aAChB,CAAC,CAAA;SACL;KACJ;;;IAID,oBAAoB,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAQ,CAAC,CAAA;;IAG/C,MAAM,IAAI,GAAGC,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,OAAQ,CAAY,CAAA;IAE3D,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;QACvB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,EAAE;YACvD,MAAM,CAAC,KAAK,CAAC;gBACT,IAAI,EAAE,aAAa;gBACnB,IAAI,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAClD,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;aACrB,CAAC,CAAA;SACL;QAED,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;YAChC,MAAM,CAAC,KAAK,CAAC;gBACT,IAAI,EAAE,aAAa;gBACnB,IAAI,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAQ,EAAE,CAAC,CAAC;gBAC/B,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;aACrB,CAAC,CAAA;SACL;KACJ;IAED,QAAQ,CAAC,KAAK,EAAE,CAAA;AACpB,CAAC;AAED,SAAS,sBAAsB,CAC3B,MAAc,EACd,OAGC;IAED,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG,OAAO,CAAA;IAChC,MAAM,IAAI,GAAGA,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IACjC,MAAM,EAAE,GAAG,QAAQ,KAAK,OAAO,GAAG,OAAO,GAAG,OAAO,CAAA;IAEnD,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;QACnB,MAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAE,CAAA;QAElC,OAAO;YACH,IAAI,EAAE,EAAE;YACR,MAAM,EAAE,QAAQ,KAAK,OAAO;kBACtB,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM;kBACf,KAAK,CAAC,KAAM;SACrB,CAAA;KACJ;IAED,KAAK,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,QAAQ,KAAK,KAAK,CAAC,EAAE;QACvE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;YACrB,OAAO,QAAQ,KAAK,OAAO;kBACrB,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,CAAC;kBACpC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,CAAC,CAAA;SAC3C;QAED,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAE,CAAA;QAEnC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM;YAAE,SAAQ;QAEnD,OAAO;YACH,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC;YACpB,MAAM,EAAE,QAAQ,KAAK,OAAO;kBACtB,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM;kBACf,KAAK,CAAC,KAAM;SACrB,CAAA;KACJ;AACL,CAAC;AAED;SACgB,oBAAoB,CAAC,MAAc,EAAE,EAAQ;IACzD,MAAM,IAAI,GAAGA,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAY,CAAA;IAE5C,KAAK,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE;QACzD,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC,CAAA;QAErC,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;eACxC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,EAAE;;YAE1C,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,EAAE,GAAG,KAAK,CAAA;YAC/B,MAAM,CAAC,KAAK,CAAC;gBACT,IAAI,EAAE,YAAY;gBAClB,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC;gBACpB,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM;gBAC1B,MAAM,EAAE,IAAI;gBACZ,UAAU,EAAE,IAAI;aACnB,CAAC,CAAA;SACL;KACJ;AACL,CAAC;AAED;;;;;;;AAOA,SAAS,eAAe,CAAC,MAAc,EAAE,EAAQ;IAC7C,MAAM,IAAI,GAAGA,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEjC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;QACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAG,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAG,EAAE,CAAC,EAAE;YAC7C,eAAe,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC,CAAA;SACtC;QACD,OAAM;KACT;;;;;;;;;;IAaD,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,aAAa,CAAC,CAAA;;IAE/C,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,qCAAqC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;IAC1E,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,qCAAqC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;;IAE1E,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,yCAAyC,EAAE,kBAAkB,CAAC,CAAA;;IAEvF,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,iEAAiE,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAE,CAAC,CAAA;IACzG,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,iEAAiE,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAE,CAAC,CAAA;;IAEzG,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,uEAAuE,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAE,CAAC,CAAA;IAC/G,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,uEAAuE,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,CAAE,CAAC,CAAA;;IAE/G,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,yCAAyC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;;AAGlF,CAAC;AAED,MAAM,eAAe,GAA0C;IAC3D,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,QAAQ;IAClB,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,QAAQ;IAClB,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,QAAQ;CACrB,CAAA;AAED,SAAS,aAAa,CAAC,IAAY;;IAC/B,OAAO,MAAA,eAAe,CAAC,IAAI,CAAC,mCAAI,IAAI,CAAA;AACxC,CAAC;AAED,SAAS,kBAAkB,CAAC,GAAW;IACnC,IAAI,KAAK,GAAG,CAAC,CAAA;IACb,IAAI,GAAG,GAAG,EAAE,CAAA;IAEZ,KAAK,IAAI,CAAC,GAAC,CAAC,EAAG,CAAC,GAAC,GAAG,CAAC,MAAM,EAAG,EAAE,CAAC,EAAE;QAC/B,IAAI,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC,EAAE;YACvB,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA;YACjB,KAAK,GAAG,CAAC,CAAA;SACZ;KACJ;IAED,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE;QACpC,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC,CAAA;KACpB;IAED,OAAO,GAAG,CAAA;AACd,CAAC;AAED;;;;;;;;AAQA,SAAS,YAAY,CACjB,MAAc,EACd,IAAU,EACV,EAAU,EACV,QAAwE;IAExE,MAAM,CAAC,kBAAkB,CAAC,MAAM,EAAE;QAC9B,MAAM,IAAI,GAAGA,MAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;QAEnC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;YACpB,MAAM,IAAI,KAAK,CAAC,kDAAkD,IAAI,GAAG,CAAC,CAAA;SAC7E;QAED,IAAI,MAAM,GAAG,CAAC,CAAA;QAEd,KAAK,MAAM,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE;YACpC,MAAM,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAA;YAC3B,MAAM,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,CAAA;YACrC,MAAM,MAAM,GAAG,CAAC,CAAC,KAAM,GAAG,MAAM,CAAA;YAEhC,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAA;YACjE,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAA;YAE9D,MAAM,IAAI,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAA;SACvC;KACJ,CAAC,CAAA;AACN;;MCtXa,aAAa,GAAG,uCAAsC;MAEtD,eAAe,GAAG,gCAA+B;MAEjD,eAAe,GAAG,4BAA2B;AAE1D;MACa,gBAAgB,GAAG,0CAAyC;MAE5D,eAAe,GAAG,yCAAwC;AAEvE;MACa,iBAAiB,GAAG;;ACZjC;AA4DA;;;;;;;SAOwB,WAAW,CAC/B,UAAgE,EAChE,GAAsB;;IAEtB,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;QACzB,GAAG,GAAG,IAAI,SAAS,EAAE,CAAC,eAAe,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAA;QAC7D,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAA;QAEnD,IAAI,KAAK,IAAI,IAAI,EAAE;YACf,MAAM,IAAI,KAAK,CAAC,gBAAgB,KAAK,CAAC,WAAW,EAAE,CAAC,CAAA;SACvD;KACJ;IAED,MAAM,IAAI,GAAG,GAAG,CAAC,eAAe,CAAA;IAEhC,IAAI,IAAI,CAAC,YAAY,KAAK,eAAe,IAAI,IAAI,CAAC,SAAS,KAAK,UAAU,EAAE;QACxE,MAAM,IAAI,KAAK,CAAC,iCAAiC,IAAI,CAAC,YAAY,IAC9D,IAAI,CAAC,SAAS,gBAAgB,eAAe,WAAW,CAAC,CAAA;KAChE;IAED,MAAM,GAAG,GAAQ;QACb,QAAQ,EAAE,MAAA,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,mCAAI,KAAK;QACjD,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,eAAe,CAAiB;QAC3D,KAAK,EAAE,EAAE;QACT,OAAO,EAAE,EAAE;KACd,CAAA;IAED,IAAI,GAAG,CAAC,OAAO,KAAK,KAAK,IAAI,GAAG,CAAC,OAAO,KAAK,KAAK,EAAE;QAChD,MAAM,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAA;KAC1D;IAED,IAAI,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAC,EAAE;QAC5C,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAE,CAAA;KAC7D;IAED,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE;QAC5B,GAAG,CAAC,OAAO,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,CAAE,CAAC,CAAC,CAAA;KAC5E;IAED,MAAM,MAAM,GAAG,UAAU,CAAC,uBAAuB,CAAC,GAAG,EAAE,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,CAAA;IAE7E,MAAM,CAAC,kBAAkB,CAAC,MAAM,EAAE;;QAC9B,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC/B,IAAI,KAAK,CAAC,YAAY,KAAK,eAAe,EAAE;gBACxC,MAAM,CAAC,WAAW,CAAC,oBAAoB,EAAE;oBACrC,SAAS,EAAE,KAAK,CAAC,YAAY;oBAC7B,SAAS,EAAE,KAAK,CAAC,SAAS;iBAC7B,CAAC,CAAA;gBACF,SAAQ;aACX;YAED,QAAQ,KAAK,CAAC,SAAS;gBACvB,KAAK,UAAU,EAAE,SAAQ;gBAEzB,KAAK,OAAO;oBACR,GAAG,CAAC,KAAK,GAAG,MAAA,KAAK,CAAC,WAAW,mCAAI,EAAE,CAAA;oBACnC,MAAK;gBAET,KAAK,SAAS;oBACV,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;oBACtB,MAAK;gBAET,KAAK,UAAU;oBACX,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;oBACvB,MAAK;gBAET;oBACI,MAAM,CAAC,WAAW,CAAC,oBAAoB,EAAE;wBACrC,SAAS,EAAE,KAAK,CAAC,YAAY;wBAC7B,SAAS,EAAE,KAAK,CAAC,SAAS;qBAC7B,CAAC,CAAA;oBACF,MAAK;aACR;SACJ;QAED,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAA;KAChC,CAAC,CAAA;IAEF,IAAI,MAAM,CAAC,QAAQ,KAAK,GAAG,CAAC,OAAO,EAAE;QACjC,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,CAAA;QAChC,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAA;KAChC;IAED,OAAO,MAAM,CAAC,QAAQ,EAAE,CAAA;AAC5B,CAAC;AAED;;;AAGA,SAAS,uBAAuB,CAAC,GAAQ,EAAE,EAAU;IACjD,MAAM,MAAM,GAAG,EAAyB,CAAA;IAExC,MAAM,CAAC,kBAAkB,GAAG,SAAS,kBAAkB,CAAC,EAAE,EAAE,EAAE,EAAE,OAAO;QACnE,IAAI,EAAE,CAAC,YAAY,KAAK,eAAe;eACpC,EAAE,CAAC,YAAY,KAAK,iBAAiB,EAAE;YACtC,MAAM,YAAY,GAAG,OAAO,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;YAE1C,IAAI,YAAY,IAAI,IAAI,EAAE;gBACtB,OAAO,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;aACtC;SACJ;QAED,MAAM,CAAC,cAAc,CAAC,EAAE,EAAE,EAAE,EAAE,OAAO,CAAC,CAAA;KACzC,CAAA;IAED,MAAM,CAAC,cAAc,GAAG,SAAS,cAAc,CAAC,EAAE,EAAE,EAAE,EAAE,OAAO;QAC3D,IAAI,EAAE,CAAC,YAAY,KAAK,eAAe;eACpC,EAAE,CAAC,YAAY,KAAK,iBAAiB,EAAE;YACtC,MAAM,YAAY,GAAG,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;YAE3C,IAAI,YAAY,IAAI,IAAI,EAAE;gBACtB,MAAM,CAAC,WAAW,CAAC,oBAAoB,EAAE;oBACrC,SAAS,EAAE,EAAE,CAAC,YAAY;oBAC1B,SAAS,EAAE,EAAE,CAAC,SAAS;oBACvB,EAAE,EAAE,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC;iBAC5B,CAAC,CAAA;gBACF,OAAO,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;aACtC;SACJ;QAED,MAAM,CAAC,WAAW,CAAC,iBAAiB,EAAE;YAClC,SAAS,EAAE,EAAE,CAAC,YAAY;YAC1B,SAAS,EAAE,EAAE,CAAC,SAAS;YACvB,EAAE,EAAE,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC;SAC5B,CAAC,CAAA;QACF,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,OAAO,CAAC,CAAA;KACpC,CAAA;IAED,MAAM,CAAC,WAAW,GAAG,SAAS,WAAW,CAAC,IAAI,EAAE,WAAW;QACvD,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,WAAW,CAAC,CAAA;KACnC,CAAA;IAED,MAAM,CAAC,QAAQ,GAAG,SAAS,QAAQ;QAC/B,OAAO,GAAG,CAAA;KACb,CAAA;IAED,OAAO,MAAM,CAAA;AACjB,CAAC;AAMD;;;;;;;;;SASgB,QAAQ,CACpB,MAA2B,EAC3B,EAAW,EACX,EAAQ,EACR,OAAsB;IAEtB,MAAM,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEvC,KAAK,MAAM,KAAK,IAAI,EAAE,CAAC,UAAU,EAAE;QAC/B,QAAQ,KAAK,CAAC,QAAQ;YACtB,KAAK,IAAI,CAAC,YAAY;gBAClB,MAAM,CAAC,kBAAkB,CAAC,KAAgB,EAAE,IAAI,CAAC,OAAQ,EAAE,OAAO,CAAC,CAAA;gBACnE,MAAK;YAET,KAAK,IAAI,CAAC,SAAS,CAAC;YACpB,KAAK,IAAI,CAAC,kBAAkB;gBACxB,MAAM,CAAC,KAAK,CAAC;oBACT,IAAI,EAAE,aAAa;oBACnB,IAAI,EAAE,IAAI,CAAC,OAAQ;oBACnB,IAAI,EAAE,EAAE,IAAI,EAAG,KAAuB,CAAC,IAAI,EAAE;iBAChD,CAAC,CAAA;gBACF,MAAK;YACT,KAAK,IAAI,CAAC,2BAA2B;gBACjC,MAAM,CAAC,KAAK,CAAC;oBACT,IAAI,EAAE,aAAa;oBACnB,IAAI,EAAE,IAAI,CAAC,OAAQ;oBACnB,IAAI,EAAE;wBACF,IAAI,EAAE,wBAAwB;wBAC9B,MAAM,EAAG,KAA+B,CAAC,MAAM;wBAC/C,KAAK,EAAG,KAA+B,CAAC,IAAI;wBAC5C,QAAQ,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;qBAC3B;iBACJ,CAAC,CAAA;gBACF,MAAK;SAIR;KACJ;IAED,IAAI,EAAE,CAAC,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;QAC5B,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,IAAI,CAAC,OAAQ,EAAE,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;KACjF;IAED,IAAI,CAAC,KAAK,EAAE,CAAA;AAChB,CAAC;AAED;;;;;;;;SAQgB,YAAY,CACxB,MAA2B,EAC3B,EAAW,EACX,EAAQ,EACR,QAAgC,EAChC,OAAsB;IAEtB,MAAM,IAAI,GAAkB,EAAE,QAAQ,EAAE,EAAE,EAAE,GAAG,QAAQ,EAAE,CAAA;IAEzD,IAAI,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;QACvB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;KAClC;IAED,IAAI,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE;QAC1B,IAAI,CAAC,OAAO,GAAG,WAAW,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,YAAY,CAAC,OAAO,CAAE,CAAC,CAAC,CAAA;KAC3E;IAED,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QAC7C,IAAI,GAAG,KAAK,UAAU,IAAI,GAAG,KAAK,MAAM;YAAE,SAAQ;QAElD,IAAI,KAAK,IAAI,IAAI,EAAE;YACf,OAAO,IAAI,CAAC,GAAG,CAAC,CAAA;SACnB;KACJ;IAED,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;IAC5C,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC,CAAA;AAC7C,CAAC;AAED;;;;;;SAMgB,cAAc,CAAC,MAA2B,EAAE,EAAQ;IAChE,oBAAoB,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEhC,KAAK,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE;QAC3E,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;YAAE,SAAQ;QAEhC,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YACzB,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAA;SACpD;aAAM;YACH,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,CAAA;YACnC,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE;gBACzB,IAAI,EAAE,WAAW;gBACjB,QAAQ,EAAE,EAAE;aACf,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,CAAA;YAChB,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;SACpC;KACJ;AACL,CAAC;AAED;;;;;;SAMgB,aAAa,CAAC,MAAc,EAAE,EAAQ;IAClD,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAkB,CAAA;IACxD,MAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAA;IAE5F,IAAI,CAAC,SAAS,EAAE;QACZ,mBAAmB,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAClC;SAAM;QACH,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QAC1B,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA;QAE9B,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE;YACvD,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;gBAC9C,SAAQ;aACX;YAED,IAAI,GAAG,GAAG,CAAC,GAAG,GAAG,EAAE;gBACf,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAA;gBACvD,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;gBAEjC,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAkB,CAAA;gBAC7D,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;uBAClE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE;oBACxC,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,CAAA;iBAC/C;aACJ;YAED,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,CAAA;YAClD,GAAG,GAAG,GAAG,CAAA;SACZ;QAED,IAAI,GAAG,GAAG,CAAC,EAAE;YACT,mBAAmB,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;YAE/B,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAkB,CAAA;YAC3D,IAAI,OAAO,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;mBAClE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE;gBACxC,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;aACzC;SACJ;KACJ;AACL,CAAC;AAED;AACA,SAAS,cAAc,CAAC,MAA2B,EAAE,EAAQ;IACzD,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEvC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;QAChC,MAAM,IAAI,KAAK,CAAC,kCAAkC,EAAE,2BAA2B,CAAC,CAAA;KACnF;IAED,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAC5B,CAAC,CAAa,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAA;IAEpE,IAAI,IAAI,EAAE;QACN,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE;YACzB,IAAI,EAAE,WAAW;YACjB,QAAQ,EAAE,EAAE;SACf,EAAE;YACC,EAAE;YACF,KAAK,EAAE,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;SACxC,CAAC,CAAA;QACF,aAAa,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC,CAAA;KACpC;SAAM;QACH,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC7B;AACL,CAAC;AAED;SACgB,aAAa,CAAC,MAA2B,EAAE,EAAQ;IAC/D,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEvC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;QAChC,MAAM,IAAI,KAAK,CAAC,kCAAkC,EAAE,2BAA2B,CAAC,CAAA;KACnF;IAED,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;QAC1B,mBAAmB,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAClC;IAED,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC;WAC3B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,EAAE,EAAE;QAC9D,OAAM;KACT;IAED,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;QAC1B,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAA;KACxC;IAED,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;IAC7B,KAAK,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAG,KAAK,IAAI,CAAC,EAAG,EAAE,KAAK,EAAE;QAC9D,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,CAAA;KACrE;IAED,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;QAC5B,MAAM,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;KAC9E;AACL,CAAC;AAED;AACA,SAAS,KAAK,CAAC,QAAyC,EAAE,OAAsB;IAC5E,MAAM,IAAI,GAAG,OAAO,QAAQ,KAAK,QAAQ;UACnC,EAAE,IAAI,EAAE,QAAQ,EAAE;UAClB,QAAQ,CAAA;IAEd,OAAO,SAAS,YAAY,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;QAC3E,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,CAAC,CAAA;QAC3C,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC7B,CAAA;AACL,CAAC;AAED;AACA,SAAS,IAAI,CAAC,QAAyC,EAAE,OAAuB;IAC5E,MAAM,IAAI,GAAG,OAAO,QAAQ,KAAK,QAAQ;UACnC,EAAE,IAAI,EAAE,QAAQ,EAAE;UAClB,QAAQ,CAAA;IAEd,OAAO,SAAS,YAAY,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;QAC3E,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,aAAP,OAAO,cAAP,OAAO,GAAI,MAAM,CAAC,CAAA;QACrD,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC5B,CAAA;AACL,CAAC;AAED;AACA,SAAS,KAAK,CAAC,QAAyC,EAAE,OAAsB;IAC5E,MAAM,IAAI,GAAG,OAAO,QAAQ,KAAK,QAAQ;UACnC,EAAE,IAAI,EAAE,QAAQ,EAAE;UAClB,QAAQ,CAAA;IAEd,OAAO,SAAS,YAAY,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;QAC3E,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,EAAE,GAAG,OAAO,EAAE,CAAC,CAAA;QAC7D,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC7B,CAAA;AACL,CAAC;AAED;AAEA;AACA,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,CAAA;AAE/B;AACA,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAA;AAE3B;MACa,MAAM,GAAkB;UACjCC,MAAI;IACJ,QAAQ,EAAE,IAAI;IACd,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC;aAC1BC,SAAO;UACPC,MAAI;IACJ,GAAG,EAAE,IAAI;IACT,GAAG,EAAE,IAAI;UACTC,MAAI;IACJ,SAAS;EACZ;AAED;MACa,IAAI,GAAkB;UAC/BH,MAAI;UACJI,MAAI;IACJ,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC;IACvB,SAAS;EACZ;AACD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,WAAW,EAAE,IAAI,CAAC,CAAA;AAErC;AACA,MAAM,UAAU,GAAG,KAAK,CAAC,YAAY,EAAE;IACnC,OAAO,EAAE,KAAK,CAAC,oBAAoB,EAAE,IAAI,CAAC;IAC1C,OAAO,EAAE,KAAK,CAAC,oBAAoB,EAAE,IAAI,CAAC;IAC1C,OAAO,EAAE,KAAK,CAAC,oBAAoB,EAAE,EAAE,IAAI,EAAE,cAAc,EAAE,CAAC;IAC9D,IAAI,EAAE,cAAc;CACvB,CAAC,CAAA;AAEF;AACA,MAAM,QAAQ,GAAG;IACb,UAAU,EAAE,KAAK,CAAC,qBAAqB,EAAE,IAAI,CAAC;IAC9C,OAAO,EAAE,KAAK,CAAC,kBAAkB,EAAE,IAAI,CAAC;IACxC,QAAQ,EAAE,KAAK,CAAC,mBAAmB,EAAE,IAAI,CAAC;CAC7C,CAAA;AAED;AACA,MAAM,MAAM,GAAG;IACX,OAAO;WACPC,OAAK;IACL,SAAS,EAAE,KAAK,CAAC,QAAQ,EAAE,SAAEA,OAAK,EAAE,OAAO,EAAE,CAAC;IAC9C,KAAK;CACR,CAAA;AAED;MACa,KAAK,GAAkB;IAChC,GAAG,IAAI;IACP,UAAU;IACV,QAAQ,EAAE,KAAK,CAAC,UAAU,EAAE,QAAQ,CAAC;IACrC,MAAM,EAAE,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;IAC/B,IAAI;UACJC,MAAI;EACP;AAED;AACA,MAAM,KAAK,GAAG,EAAE,GAAG,IAAI,EAAE,GAAG,MAAM,EAAE,CAAA;AAEpC;AACA,MAAM,KAAK,GAAG;IACV,UAAU,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC;IACjC,KAAK,EAAEC,WAAS;IAChB,KAAK,EAAEA,WAAS;IAChB,KAAK,EAAEA,WAAS;CACnB,CAAA;AAED;AACA,MAAM,IAAI,GAAG;IACT,OAAO,EAAE,KAAK,CAAC,cAAc,EAAE,IAAI,CAAC;IACpC,KAAK,EAAE,KAAK,CAAC,YAAY,EAAE,IAAI,CAAC;IAChC,SAAS,EAAE,KAAK,CAAC,gBAAgB,EAAE,IAAI,CAAC;IACxC,KAAK;CACR,CAAA;AAED;AACA,MAAM,UAAU,GAAG;IACf,GAAG,KAAK;IACR,MAAM,EAAE,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;IAC/B,KAAK;CACR,CAAA;AAED;AACA,MAAM,IAAI,GAAG,EAAE,IAAI,EAAE,CAAA;AAErB;AACA,MAAM,QAAQ,GAAG,EAAE,UAAU,EAAE,CAAA;AAE/B;AACA,MAAM,OAAO,GAAG,EAAE,GAAG,KAAK,EAAE,OAAO,EAAE,CAAA;AAErC;AACA,MAAM,OAAO,GAAG,EAAE,GAAG,OAAO,EAAE,KAAK,EAAE,CAAA;AAErC;AACA,MAAM,QAAQ,GAAkB,EAAE,GAAG,MAAM,EAAE,GAAG,OAAO,EAAE,GAAG,KAAK,EAAE,CAAA;AAEnE;AAEA;AACA,SAASP,MAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC5D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC;QACjC,SAAS,EAAE,EAAE,CAAC,YAAY,CAAC,SAAS,CAAC,KAAK,OAAO,GAAG,OAAO,GAAG,MAAM;KACvE,EAAE,MAAM,CAAC,CAAA;;;AAGd,CAAC;AAED;AACA,SAAS,OAAO,CAAC,MAA2B,EAAE,EAAW;IACrD,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAA;IAClC,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED;AACA,SAAS,cAAc,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IACtE,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,iBAAiB;QACvB,SAAS,EAAE,EAAE,CAAC,cAAc,CAAC,gBAAgB,EAAE,WAAW,CAAC;KAC9D,EAAE,MAAM,CAAC,CAAA;IACV,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC7B,CAAC;AAED;AACA,SAASC,SAAO,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC/D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,SAAS;QACf,QAAQ,EAAE,EAAE,CAAC,cAAc,CAAC,aAAa,EAAE,MAAM,CAAC;KACrD,EAAE,MAAM,CAAC,CAAA;IACV,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC7B,CAAC;AAED;AACA,SAAS,QAAQ,CAAC,MAA2B,EAAE,EAAW;IACtD,MAAM,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA;IACrC,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,QAAQ,CAAC,CAAA;IAC9D,cAAc,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;AAChC,CAAC;AAED;AACA,SAAS,IAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC5D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,WAAW,EAAE,EAAE,KAAK,CAAC,CAAA;IAC1D,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAE1B,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAkB,CAAA;IACxD,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;QAC7D,UAAU,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;KACzC;AACL,CAAC;AAED;AACA,SAASC,MAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC5D,MAAM,MAAM,GAAG,EAAE,CAAC,YAAY,CAAC,WAAW,CAAC,CAAA;IAC3C,MAAM,QAAQ,GAAG,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,CAAA;IAC5C,MAAM,GAAG,GAAG,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,CAAA;IAElC,IAAI,MAAM,IAAI,IAAI,EAAE;QAChB,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;YACzB,IAAI,EAAE,MAAM;YACZ,MAAM;YACN,QAAQ;YACR,IAAI,EAAE,EAAE,CAAC,cAAc,CAAC,gBAAgB,EAAE,MAAM,CAAC;YACjD,QAAQ,EAAE,EAAE;SACf,EAAE,EAAE,CAAC,CAAA;QACN,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC5B;SAAM,IAAI,GAAG,IAAI,IAAI,EAAE;QACpB,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,EAAE,MAAM,CAAC,CAAA;QAC3D,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC5B;SAAM,IAAI,QAAQ,IAAI,IAAI,EAAE;QACzB,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,EAAE,MAAM,CAAC,CAAA;QAClE,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;KAC5B;SAAM;QACH,MAAM,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAA;QACzC,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,CAAA;KACnC;AACL,CAAC;AAED,SAASE,MAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;;IAC5D,MAAM,KAAK,GAAG,EAAE,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,YAAY;UACrD;YACE,IAAI,EAAE,MAAM;YACZ,KAAK,EAAE,YAAY;YACnB,WAAW,EAAE,MAAA,EAAE,CAAC,YAAY,CAAC,cAAc,CAAC,mCAAI,QAAQ;YACxD,KAAK,EAAE,MAAM,CAAC,MAAA,EAAE,CAAC,YAAY,CAAC,aAAa,CAAC,mCAAI,CAAC,CAAC;SACrD;UACC;YACE,IAAI,EAAE,MAAM;YACZ,KAAK,EAAE,UAAU;YACjB,MAAM,EAAE,MAAA,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,mCAAI,QAAQ;SAChD,CAAA;IAEL,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,CAAA;IACzC,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED,MAAM,KAAK,GAAgD;IACvD,GAAG,EAAE,EAAE,QAAQ,EAAE,WAAW,EAAE;IAC9B,GAAG,EAAE,EAAE,QAAQ,EAAE,aAAa,EAAE;IAChC,IAAI,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE;IACtB,SAAS,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE;IAC9B,OAAO,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE;CAC9B,CAAA;AAED;AACA,SAAS,IAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;;IAC5D,MAAM,IAAI,GAAG,EAAE,CAAC,SAAS,KAAK,UAAU;UAClC,MAAA,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,mCAAI,MAAM;UACnC,EAAE,CAAC,SAAS,CAAA;IAClB,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,CAAA;IACzB,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IAEtC,QAAQ,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,CAAA;IAEhC,IAAI,KAAK,IAAI,IAAI,EAAE;QACf,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE;YAC/B,EAAE,EAAE,MAAM,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAQ,CAAC,CAAC;YACzD,KAAK,EAAE,IAAI,CAAC,MAAM;SACrB,CAAC,CAAA;KACL;IAED,GAAG,CAAC,KAAK,EAAE,CAAA;AACf,CAAC;AAED;AACA,SAASC,OAAK,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC7D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,KAAK,CAAC,CAAA;IAEtD,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAkB,CAAA;IAExD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAa,KAAK,CAAC,CAAC,IAAI,KAAK,WAAW,CAAC;WAC/D,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;QACvB,MAAM,IAAI,GAAG,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA;QAC1C,MAAM,CAAC,KAAK,CAAC;YACT,IAAI,EAAE,aAAa;YACnB,IAAI;YACJ,IAAI,EAAE;gBACF,IAAI,EAAE,WAAW;gBACjB,QAAQ,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,YAAY,CAAC,KAAK,CAAE,EAAE,CAAC;aAChD;SACJ,CAAC,CAAA;QACF,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;KACpC;IAED,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED;AACA,SAASE,WAAS,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IACjE,MAAM,GAAG,GAAG,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,CAAA;IAElC,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,QAAQ,GAAG,EAAE,CAAC,SAAS;QAC7B,GAAG,EAAE,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC;QAC3B,WAAW,EAAE,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,KAAK;KACtD,EAAE,EAAE,CAAC,CAAA;IAEN,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC7B,CAAC;AAED;AACA,SAAS,IAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;;IAC5D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,YAAY;QAClB,IAAI,EAAE,MAAA,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,mCAAI,MAAM;KAC1C,EAAE,UAAU,CAAC,CAAA;IACd,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED;AACA,SAAS,SAAS,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IACjE,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,WAAW,EAAE,EAAE,MAAM,CAAC,CAAA;;;AAG/D,CAAC;AAED;AACA,SAASD,MAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;;IAC5D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,MAAA,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,mCAAI,MAAM;KAC1C,EAAE,IAAI,CAAC,CAAA;IACR,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED;AACA,SAAS,OAAO,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC/D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,OAAO,CAAC,CAAA;IAC1D,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC9B,CAAC;AAED;AACA,SAASH,MAAI,CAAC,MAA2B,EAAE,EAAW,EAAE,EAAQ;IAC5D,YAAY,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE;QACzB,IAAI,EAAE,MAAM;QACZ,KAAK,EAAE,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,OAAO,CAAC;QAClD,SAAS,EAAE,EAAE,CAAC,cAAc,CAAC,gBAAgB,EAAE,WAAW,CAAC;QAC3D,IAAI,EAAE,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,MAAM,CAAC;QAChD,IAAI,EAAE,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,MAAM,CAAC;cAC1C,MAAM,CAAC,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;cAClD,SAAS;QACf,IAAI,EAAE,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,MAAM,CAAC;cAC1C,MAAM,CAAC,EAAE,CAAC,cAAc,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;cAClD,SAAS;KAClB,EAAE,MAAM,CAAC,CAAA;IACV,aAAa,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;AAC7B;;AC9wBA;;;;;;ACAA;AASA;SACgB,aAAa,CAIzB,IAAO,EACP,KAAe,EACf,GAAG,QAAgB;IAEnB,MAAM,EAAE,KAAK,EAAE,GAAG,UAAU,EAAE,GAAG,KAAK,aAAL,KAAK,cAAL,KAAK,GAAK,EAAiB,CAAA;IAE5D,OAAO;QACH,IAAI,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;QACvC,UAAU;QACV,QAAQ;KACX,CAAA;AACL,CAAC;AAED;SACgB,GAAG,CAGjB,IAAO,EAAE,KAAQ;IACf,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,UAAU,EAAE,GAAG,KAAK,CAAA;IAEhD,OAAO;QACH,IAAI,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;QACvC,UAAU;QACV,QAAQ,EAAE,QAAQ,aAAR,QAAQ,cAAR,QAAQ,GAAI,EAAE;KAC3B,CAAA;AACL,CAAC;MAEY,IAAI,GAAG;;ACzCpB;MAgDaJ,MAAI,GAAG;IAChB,SAAS,CAAC,IAAU;QAChB,OAAO,aAAa,CAAC,IAAI,CAAC,IAAI,OAAQ,IAAgB,CAAC,IAAI,KAAK,QAAQ,CAAA;KAC3E;IACD,uBAAuB,CAAC,IAAU;QAC9B,OAAO,IAAI,IAAI,IAAI,IAAI,OAAQ,IAA8B,CAAC,MAAM,KAAK,QAAQ,CAAA;KACpF;EACJ;AAED;AACA,MAAM,kBAAkB,GAAiC;IACrD,GAAG,EAAE,aAAa;IAClB,MAAM,EAAE,gBAAgB;IACxB,KAAK,EAAE,eAAe;IACtB,OAAO,EAAE,iBAAiB;CAC7B,CAAA;AAQD;SACgB,MAAM,CAAC,IAAa;IAChC,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAA;IACrC,MAAM,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAC,cAAc,CAC9C,SAAS,aAAT,SAAS,cAAT,SAAS,GAAI,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;IAC7C,MAAM,QAAQ,GAAG,EAAE,SAAS,EAAE,SAAS,aAAT,SAAS,cAAT,SAAS,GAAI,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,EAAE,CAAA;IAEhE,KAAK,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;QAC5D,IAAI,GAAG,KAAK,aAAa;YAAE,SAAQ;QAEnC,GAAG,CAAC,eAAe,CAAC,cAAc,CAAC,eAAe,EAAE,SAAS,MAAM,EAAE,EAAE,GAAG,CAAC,CAAA;KAC9E;IAED,aAAa,CAAC,QAAQ,EAAE,IAAI,EAAE,GAAG,CAAC,eAAe,CAAC,CAAA;IAElD,OAAO,GAAG,CAAA;AACd,CAAC;AAED;AACA,SAAS,aAAa,CAAC,QAAkB,EAAE,OAAgB;;IACvD,MAAM,EAAE,GAAG,MAAA,OAAO,CAAC,IAAI,CAAC,SAAS,mCAAI,QAAQ,CAAC,SAAS,CAAA;IACvD,MAAM,EAAE,GAAG,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;IAE/D,aAAa,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,CAAC,CAAA;IAEpC,OAAO,EAAE,CAAA;AACb,CAAC;AAED;AACA;AACA,MAAM,UAAU,GAAG;IACf,YAAY,EAAE,SAAS,EAAE,YAAY,EAAE,UAAU,EAAE,SAAS,EAAE,UAAU;IACxE,QAAQ,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,EAAE,SAAS;IAC3E,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,UAAU,EAAE,WAAW;IACvE,WAAW;CACd,CAAA;AACD;AAEA;;;;AAIA,MAAM,mBAAmB,GAAG;IACxB,QAAQ;IACR,UAAU;CACb,CAAA;AAED;AACA,SAAS,aAAa,CAAC,QAAkB,EAAE,OAAgB,EAAE,GAAuB;;IAChF,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;QAC3D,IAAI,mBAAmB,CAAC,QAAQ,CAAC,GAAG,CAAC;YAAE,SAAQ;QAC/C,IAAI,KAAK,IAAI,IAAI;YAAE,SAAQ;QAE3B,IAAI,GAAG,CAAA;QAEP,QAAQ,OAAO,KAAK;YACpB,KAAK,QAAQ;gBACT,GAAG,GAAG,KAAK,CAAA;gBACX,MAAK;YAET,KAAK,QAAQ,CAAC;YACd,KAAK,SAAS,CAAC;YACf,KAAK,QAAQ,CAAC;YACd,KAAK,QAAQ;gBACT,GAAG,GAAG,KAAM,CAAC,QAAQ,EAAE,CAAA;gBACvB,MAAK;YAET;gBACI,SAAQ;SACX;QAED,MAAM,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAA;QAC5C,IAAI,CAAC,EAAE;YACH,MAAM,GAAG,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,CAAA;YAC1B,MAAM,EAAE,GAAG,kBAAkB,CAAC,MAAM,CAAC,CAAA;YAErC,IAAI,EAAE,IAAI,IAAI,EAAE;gBACZ,MAAM,IAAI,KAAK,CACX,4BAA4B,MAAM,kBAAkB,GAAG,EAAE,CAAC,CAAA;aACjE;YAED,GAAG,CAAC,cAAc,CAAC,EAAE,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAA;SAC7D;aAAM;YACH,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAA;SACxC;KACJ;IAED,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAA;IAChC,MAAM,MAAM,GAAG,GAAG,CAAC,YAAY,KAAK,eAAe,IAAI,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC;UACjF,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;UACzB,IAAI,CAAA;IACV,MAAM,CAAC,GAAG;QACN,GAAG,QAAQ;QACX,KAAK;QACL,SAAS,EAAE,MAAA,OAAO,CAAC,IAAI,CAAC,SAAS,mCAAI,QAAQ,CAAC,SAAS;KAC1D,CAAA;IAED,IAAI,KAAK,GAAG,CAAC,CAAA;IAEb,SAAS,WAAW,CAAC,KAAW;QAC5B,IAAI,KAAK,IAAI,IAAI;YAAE,OAAM;QAEzB,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YACtB,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;gBACtB,WAAW,CAAC,IAAI,CAAC,CAAA;aACpB;YACD,OAAM;SACT;QAED,IAAI,MAAM,IAAI,IAAI,EAAE;YAChB,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;SACrB;QAED,IAAI,KAAK,YAAY,UAAU,CAAC,IAAI,EAAE;YAClC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAA;SACnD;aAAM,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;YAClC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;SACpB;aAAM,IAAIA,MAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,EAAE;YAC5C,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,2BAA2B,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;SAC9E;aAAM;YACH,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAA;SACtC;QAED,KAAK,IAAI,CAAC,CAAA;KACb;IAED,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA;IAE7B,IAAI,KAAK,GAAG,CAAC,IAAI,MAAM,IAAI,IAAI,EAAE;QAC7B,GAAG,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAA;KACjD;AACL;;ACzJA;SACwB,SAAS,CAC7B,MAAc,EACd,GAAQ,EACR,OAA+B;;IAE/B,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,OAAO,CAAA;IACrC,MAAM,OAAO,GAAG;QACZ,SAAS;QACT,aAAa,EAAE,OAAO,CAAC,aAAa;KACvC,CAAA;IAED,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC,CAAA;IACvE,MAAM,QAAQ,GAAG,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;UACnE,OAAO,CAAC,GAAG,EAAG;UACd,IAAI,CAAA;IAEV,MAAM,QAAQ,GAAG,MAAM,CAACS,iCACpB,KAAK,EAAE,eAAe,mBACP,GAAG,CAAC,OAAO,EAC1B,EAAE,EAAE,GAAG,CAAC,QAAQ,eACL,GAAG,CAAC,QAAQ,EACvB,OAAO,EAAE,GAAG,CAAC,QAAQ,EACrB,KAAK,EAAE,MAAA,GAAG,CAAC,OAAO,0CAAE,IAAI,CAAC,GAAG,CAAC,iBAE7BC,yBAAQ,GAAG,CAAC,KAAK,WAAS,EAC1BA,2BACK,OAAO,WACF,EACT,QAAQ,KACF,CAAC,CAAA;IAEZ,IAAI,MAAM,KAAK,KAAK,EAAE;QAClB,OAAO,QAAQ,CAAA;KAClB;IAED,IAAI,CAAC,GAAG,IAAI,aAAa,EAAE,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAA;;IAGvD,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;QACxB,CAAC,GAAG,iCAAiC,QAAQ,CAAC,YAAY,QAAQ,CAAC,EAAE,CAAA;KACxE;IAED,OAAO,CAAC,CAAA;AACZ,CAAC;AAiBD;AACA,SAAS,aAAa,CAAC,MAAc,EAAE,IAAU,EAAE,GAAY;IAC3D,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;QACnB,IAAI,CAAC,GAAe,IAAI,CAAC,IAAI,CAAA;QAE7B,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE;YACxB,IAAI,KAAK,IAAI,IAAI,EAAE;gBACf,CAAC,GAAG,cAAc,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAqB,EAAE,CAAC,CAAC,CAAA;aAChE;SACJ;QAED,OAAO,CAAC,CAAA;KACX;IAED,MAAM,QAAQ,GAAG,MAAM,CAAC,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC;UAC1C,aAAa,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,CAAC;UAChC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAA;IAE3D,MAAM,UAAU,GAAgB;QAC5B,EAAE,EAAE,IAAI,CAAC,EAAY,IAAI,OAAOC,EAAO,EAAE,EAAE;KAC9C,CAAA;IAED,IAAI,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;QAC9B,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;KAC5C;IAED,IAAI,GAAG,CAAC,aAAa,IAAI,IAAI,EAAE;QAC3B,MAAM,CAAC,GAAG,GAAG,CAAC,aAAa,CAAC,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAA;QAC5D,IAAI,CAAC,IAAI,IAAI,EAAE;YACX,OAAO,CAAC,CAAA;SACX;KACJ;IAED,KAAK,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,WAAW,EAAE;QAC1C,IAAI,IAAI,CAAC,IAAI,CAAC,EAAE;YACZ,OAAO,UAAU,CAAC,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAA;SACrD;KACJ;IAED,MAAM,IAAI,KAAK,CAAC,6BAA6B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;AACxE,CAAC;AAED;AACA,SAAS,WAAW,CAAC,IAAU;IAC3B,IAAI,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;QACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,WAAW,CAAC,CAAA;KAC1C;IAED,MAAM,IAAI,GAAG,IAAkB,CAAA;IAE/B,OAAO,CAAC,IAAI,CAAC,QAAQ;WACd,CAAC,IAAI,CAAC,MAAM;YACX,IAAI,CAAC,QAAQ,IAAI,IAAI,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAA;AAChE,CAAC;AAKD,MAAM,MAAM,GAAgB,CAAC,UAAU,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAA;AAK3E;AACA,SAAS,cAAc,CAAC,KAAgB,EAAE,KAAuB,EAAE,IAAgB;IAC/E,QAAQ,KAAK;QACb,KAAK,UAAU;YACX,OAAO,KAAK;kBACND,gCAAU,KAAK,EAAE,eAAe,EAAE,MAAM,EAAC,SAAS,gBAAE,IAAI,IAAY;kBACpE,IAAI,CAAA;QAEd,KAAK,QAAQ;YACT,OAAO,KAAK;kBACNA,gCAAU,KAAK,EAAE,eAAe,EAAE,MAAM,EAAC,MAAM,gBAAE,IAAI,IAAY;kBACjE,IAAI,CAAA;QAEd,KAAK,WAAW;YACZ,OAAO,KAAK;kBACNA,gCAAU,KAAK,EAAE,eAAe,EAAE,MAAM,EAAC,WAAW,gBAAE,IAAI,IAAY;kBACtE,IAAI,CAAA;QAEd,KAAK,UAAU;YACX,OAAO,KAAK,KAAK,aAAa;kBACxBA,2BAAK,KAAK,EAAE,eAAe,gBAAG,IAAI,IAAO;kBACzC,KAAK,KAAK,WAAW;sBACjBA,2BAAK,KAAK,EAAE,eAAe,gBAAG,IAAI,IAAO;sBACzC,IAAI,CAAA;KACjB;AACL,CAAC;AAED;AACA,SAAS,UAAU,CAAC,MAAa,EAAE,IAAgB;IAC/C,KAAK,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,MAAM,EAAE;QACjC,IAAI,GAAG,cAAc,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,CAAA;KAC5C;IAED,OAAO,IAAI,CAAA;AACf,CAAC;AAED;AACA,SAAS,aAAa,CAAC,MAAc,EAAE,IAAa,EAAE,GAAY;IAC9D,MAAM,GAAG,GAAiB,EAAE,CAAA;IAC5B,MAAM,IAAI,GAA4B,CAAC,CAAC,IAAI,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAA;;IAGvD,SAAS,KAAK;QACV,OAAO,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;YACpB,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,EAAG,CAAA;YAClC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;SAC1D;QAED,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,EAAG,CAAA;QAClC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,CAAA;QAE1B,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;KACrC;;IAGD,SAAS,QAAQ,CAAC,IAAY;QAC1B,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAG,CAAC,GAAG,IAAI,EAAG,EAAE,CAAC,EAAE;YAC3C,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;YAE9B,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;gBAClB,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAA;gBAC7C,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAA;aAClB;SACJ;KACJ;;IAGD,SAAS,WAAW,CAAC,OAAc;QAC/B,MAAM,IAAI,GAAG,IAAI,GAAG,EAAE,CAAA;;;QAItB,KAAK,MAAM,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE;YACxB,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,KAAK,EAAE;gBAC/B,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,KAAK,EAAE;oBAClD,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;oBACpB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;iBACjB;aACJ;SACJ;;QAGD,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAG,CAAC,IAAI,CAAC,EAAG,EAAE,CAAC,EAAE;YACzC,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;YAEvB,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,KAAK,EAAE;;;;;gBAK/B,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;oBAAE,SAAQ;gBAE5B,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,KAAK,EAAE;oBACnD,QAAQ,CAAC,CAAC,CAAC,CAAA;oBACX,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;oBACtD,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;iBACrB;aACJ;;YAGD,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;gBAC3B,QAAQ,CAAC,CAAC,CAAC,CAAA;gBACX,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;gBAClC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;aACpB;SACJ;QAED,IAAI,OAAO,CAAC,IAAI,GAAG,CAAC,EAAE;YAClB,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAA;SAC3B;KACJ;IAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;QAC/B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;YACrB,KAAK,EAAE,CAAA;YACP,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,CAAA;YAC3C,SAAQ;SACX;QAED,MAAM,KAAK,GAAG,IAAI,GAAG,EAAE,CAAA;QACvB,KAAK,MAAM,CAAC,IAAI,MAAM,EAAE;YACpB,IAAI,CAAC,IAAI,KAAK,EAAE;gBACZ,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;aACzB;SACJ;QAED,WAAW,CAAC,KAAK,CAAC,CAAA;QAClB,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;KAC5C;IAED,KAAK,EAAE,CAAA;IACP,OAAO,GAAG,CAAA;AACd,CAAC;AAQD;;;;;;;AAOA,MAAM,WAAW,GAA4B;IACzC,CAAC,UAAU,CAAC,YAAY,EAAE,UAAU,CAAC;IACrC,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC;IAC5B,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC;IAC1B,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAC9C,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACnB,CAAC,UAAU,CAAC,YAAY,EAAE,cAAc,CAAC,YAAY,CAAC,CAAC;IACvD,CAAC,cAAc,CAAC,gBAAgB,EAAE,IAAI,CAAC;IACvC,CAAC,UAAU,CAAC,YAAY,EAAE,cAAc,CAAC,YAAY,CAAC,CAAC;IACvD,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAClE,CAAC,cAAc,CAAC,gBAAgB,EAAE,IAAI,CAAC;IACvC,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,MAAM,CAAC;IAC/C,CAAC,QAAQ,CAAC,UAAU,EAAE,cAAc,CAAC,UAAU,CAAC,CAAC;IACjD,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC;IACzB,CAAC,QAAQ,CAAC,UAAU,EAAE,cAAc,CAAC,UAAU,CAAC,CAAC;IACjD,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC;IAC5B,CAAC,QAAQ,CAAC,UAAU,EAAE,cAAc,CAAC,UAAU,CAAC,CAAC;IACjD,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC;IAC1B,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACnB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACnB,CAAC,QAAQ,CAAC,UAAU,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC;IAC7C,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAC9C,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC;IACtB,CAAC,SAAS,CAAC,WAAW,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC;IAC/C,CAAC,SAAS,CAAC,WAAW,EAAE,cAAc,CAAC,WAAW,CAAC,CAAC;IACpD,CAAC,qBAAqB,CAAC,uBAAuB,EAAE,qBAAqB,CAAC;IACtE,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAC9C,CAAC,KAAK,CAAC,OAAO,EAAE,cAAc,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC,SAAS,CAAC,WAAW,EAAE,cAAc,CAAC,OAAO,CAAC,CAAC;IAChD,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACnB,CAAC,WAAW,CAAC,aAAa,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IACtD,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAC9C,CAAC,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,SAAS,CAAC,CAAC;IAC9C,CAAC,QAAQ,CAAC,UAAU,EAAE,cAAc,CAAC,UAAU,CAAC,CAAC;IACjD,CAAC,SAAS,CAAC,WAAW,EAAE,cAAc,CAAC,WAAW,CAAC,CAAC;IACpD,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACnB,CAAC,KAAK,CAAC,OAAO,EAAE,cAAc,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC;;;;CAIF,CAAA;AAE5B;AACA;AACA,SAAS,cAAc,CAAC,GAAW,EAAE,YAAoB,eAAe;IACpE,OAAO,SAAS,UAAU,CAAC,IAAU,EAAE,KAAkB,EAAE,QAAoB;QAC3E,OAAOA,IAAC,GAAG,kBAAC,KAAK,EAAE,SAAS,IAAM,KAAK,cAAI,QAAQ,IAAQ,CAAA;KAC9D,CAAA;AACL,CAAC;AAED,SAAS,UAAU,CAAC,IAAgB,EAAE,KAAkB,EAAE,QAAoB;IAC1E,OAAOA,4BAAM,KAAK,EAAE,eAAe,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,IAAM,KAAK,cAAG,QAAQ,IAAQ,CAAA;AACtF,CAAC;AAED,SAAS,OAAO,CAAC,IAAa,EAAE,KAAkB,EAAE,QAAoB;;;IAGpE,IAAI,WAAW,CAAC,IAAI,CAAC,EAAE;QACnB,OAAO,IAAI,CAAA;KACd;IAED,OAAOA,gCAAU,KAAK,EAAE,iBAAiB,IAAM,KAAK,cAAG,QAAQ,IAAY,CAAA;AAC/E,CAAC;AAED,SAAS,IAAI,CAAC,IAAoB,EAAE,KAAkB,EAAE,QAAoB;IACxE,OAAOA,4BACH,KAAK,EAAE,eAAe,EACtB,OAAO,EAAE,IAAI,CAAC,SAAS,KAAK,OAAO,GAAG,OAAO,GAAG,SAAS,EACzD,IAAI,EAAE,IAAI,CAAC,QAAQ,IACf,KAAK,cAER,QAAQ,IACN,CAAA;AACX,CAAC;AAED,SAAS,MAAM,CAAC,IAAuB,EAAE,KAAkB,EAAE,QAAoB;IAC7E,OAAOA,4BAAM,KAAK,EAAE,eAAe,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,IAAM,KAAK,cAAI,QAAQ,IAAS,CAAA;AAChG,CAAC;AAED,SAAS,MAAM,CAAC,IAAY,EAAE,KAAkB,EAAE,QAAsB;IACpE,SAAS,QAAQ,CAAC,KAAiB;QAC/B,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YACtB,OAAO,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;SAC7B;QAED,IAAI,CAACE,MAAU,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;YAC9B,OAAO,KAAK,CAAA;SACf;QAED,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,KAAK,eAAe;eACzC,KAAK,CAAC,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE;YAC9B,OAAO;gBACH,GAAG,KAAK;gBACR,IAAI,EAAE;oBACF,SAAS,EAAE,eAAe;oBAC1B,KAAK,EAAE,WAAW;iBACrB;aACJ,CAAA;SACJ;QAED,OAAO,KAAK,CAAA;KACf;IAED,OAAOF,8BAAQ,KAAK,EAAE,eAAe,IAAM,KAAK,cAC3C,QAAQ,CAAC,QAAQ,CAAC,IACd,CAAA;AACb,CAAC;AAED,SAAS,OAAO,CAAC,IAAa,EAAE,KAAkB,EAAE,QAAoB;IACpE,OAAOA,+BAAS,KAAK,EAAE,eAAe,EAAE,OAAO,EAAE,IAAI,CAAC,QAAQ,IAAM,KAAK,cACnE,QAAQ,IACJ,CAAA;AACd,CAAC;AAED,SAAS,IAAI,CAAC,IAAU,EAAE,KAAkB,EAAE,QAAoB;IAC9D,OAAOA,4BAAM,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,IAAM,KAAK,cAAI,QAAQ,IAAS,CAAA;AACtF,CAAC;AAED,SAAS,IAAI,CAAC,IAAU,EAAE,KAAkB,EAAE,QAAoB;IAC9D,SAAS,QAAQ,CAAC,KAAiB;QAC/B,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;QAEpD,IAAI,CAACE,MAAU,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;YAC9B,OAAO,KAAK,CAAA;SACf;QAED,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,KAAK,eAAe;eAC1E,KAAK,CAAC,IAAI,CAAC,KAAK,KAAK,MAAM,EAAE;YAC5B,OAAOF,4BAAM,KAAK,EAAE,eAAe,gBAAG,KAAK,IAAQ,CAAA;SACtD;QAED,OAAO,KAAK,CAAA;KACf;IAED,OAAOA,4BACH,KAAK,EAAE,eAAe,eACX,IAAI,CAAC,KAAK,KAAK,YAAY,GAAG,IAAI,CAAC,KAAK,GAAG,SAAS,mBAChD,IAAI,CAAC,MAAM,KAAK,QAAQ,GAAG,IAAI,CAAC,MAAM,GAAG,SAAS,CAAW,mBAC7D,IAAI,CAAC,WAAW,KAAK,QAAQ,GAAG,IAAI,CAAC,WAAW,GAAG,SAAS,CAAgB,kBAC7E,IAAI,CAAC,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,SAAS,CAAW,IAC9D,KAAK,cAER,QAAQ,CAAC,QAAQ,CAAC,IAChB,CAAA;AACX,CAAC;AAED,SAAS,KAAK,CAAC,IAAW,EAAE,KAAkB,EAAE,QAAoB;IAChE,IAAI,GAAW,CAAA;IAEf,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAA;IAC7D,IAAI,OAAO,IAAI,IAAI,IAAI,WAAW,CAAC,OAAO,CAAC,EAAE;QACzC,GAAG,GAAGV,MAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAA;KAC7B;IAED,OAAOU,6BAAO,KAAK,EAAE,eAAe,EAAE,GAAG,EAAE,GAAI,IAAM,KAAK,cAAG,QAAQ,IAAS,CAAA;AAClF,CAAC;AAED,SAAS,SAAS,CACd,IAA2B,EAC3B,KAAkB,EAClB,QAAoB,EACpB,GAAY;IAEZ,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAgC,CAAA;IAE7D,OAAOA,IAAC,GAAG,kBACP,KAAK,EAAE,eAAe,EACtB,GAAG,EAAE,IAAI,CAAC,GAAG,eACF,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,EAC9B,GAAG,EAAE,IAAI,CAAC,WAAW,KAAK,KAAK,GAAG,SAAS,GAAG,IAAI,CAAC,WAAW,IAC1D,KAAK,cAER,QAAQ,IACP,CAAA;AACV,CAAC;AAED,SAAS,qBAAqB,CAAC,IAA2B;IACtD,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAA;AACrD,CAAC;AAED,SAAS,IAAI,CAAC,IAAU,EAAE,KAAkB,EAAE,QAAoB;IAC9D,OAAOA,4BACH,KAAK,EAAE,eAAe,EACtB,IAAI,EAAE,IAAI,CAAC,IAAI,KAAK,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,IAAI,IAC9C,KAAK,cACR,QAAQ,IACN,CAAA;AACX,CAAC;AAED,SAAS,IAAI,CAAC,IAAqB,EAAE,KAAkB,EAAE,QAAoB;IACzE,MAAM,mBAAmB,GAA+B,EAAE,CAAA;IAE1D,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;QACvB,mBAAmB,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAA;QACzC,mBAAmB,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAA;QACzC,mBAAmB,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAA;KAC5C;IAED,OAAOA,4BACH,KAAK,EAAE,eAAe,EACtB,UAAU,EAAE,IAAI,CAAC,KAAK,EACtB,eAAe,EAAE,IAAI,CAAC,SAAS,IAC3B,mBAAmB,EACnB,KAAK,cACP,QAAQ,IACP,CAAA;AACX,CAAC;AAED,SAAS,IAAI,CAAC,IAAoB,EAAE,KAAkB,EAAE,QAAoB;;IACxE,OAAOA,4BACH,KAAK,EAAE,eAAe,eACX,IAAI,CAAC,MAAM,EACtB,QAAQ,EAAE,MAAA,IAAI,CAAC,QAAQ,mCAAI,SAAS,EACpC,UAAU,EAAE,IAAI,CAAC,IAAI,IACjB,KAAK,cAER,QAAQ,IACN,CAAA;AACX;;;;"}